{
  "hash": "97caea3dd63b52695e4804b908b24de6",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Data Axle - Businesses in Sharswood\"\nsubtitle: \"URBS 4000: Urban Studies Thesis\"\nauthor: \"Jed Chew\"\ndate: today\nformat: \n  html:\n    code-fold: false\n    toc: true\n    toc-location: left\n    theme: cosmo\n    embed-resources: true\nexecute:\n  warning: false\n  message: false\neditor: \n  markdown: \n    wrap: 80\n---\n\n## Project Title: Mixed by Design\n\n### *A Case Study of the Philadelphia Housing Authority's (PHA) Choice Neighborhoods Redevelopment of Sharswood*\n\nFor my Urban Studies thesis, I am researching the PHA's Choice Neighborhoods\nredevelopment of the Sharswood neighborhood in North Philadelphia. I have two\nmain research questions about the process and outcome of this redevelopment:\n\n\\(1\\) the **process** by which the PHA aligned the politics, finance, and design\nfor the redevelopment of Sharswood; and \n\n\\(2\\) the early redevelopment **outcomes** relative to the Choice Neighborhoods\nInitiative (CNI) vision of mixed-partners, mixed-use, and mixed-income\n\n## Part 1: Raw Data from Data Axle\n\n**Data Axle Reference Solutions** (formerly ReferenceUSA and Infogroup) is a big\ndata, analytics, and marketing services provider that delivers best in class\ndata-driven, customer-centric technology solutions. It offers two main types of\ndata:\n\n-   **Residential Historic Data:** Analyze community growth and general\n    population differences.\n-   **Historic Business Data:** Analyze market trends, economic growth, or\n    specific industries. Access categories including Company Name, Geocodes,\n    SIC/NAICS codes, Census Tracts.\n\nI retrieved my raw data files from Data Axle through Penn Libraries and Wharton\nResearch and Data Services (WRDS) on October 15, 2025. The interface of Data\nAxle is shown below.\n\n![](images/clipboard-3282527950.png){width=\"887\"}\n\n### Record Types\n\n**Verified Records:** have been verified by DataAxle staff through various\ncompilation processes including phone validation\n\n**Unverified Records**: separate database from verified records because of one\nof the following reasons:\n\n-   records appear within data sources but have yet to be fully verified\n-   partial information is contained in the record, but not all data elements\n    are present to be considered 'verified' at the point of data retrieval\n-   addresses are unverified (e.g. a business may have moved)\n\n### Step 1: Load Raw Data as csv files\n\n-   DataAxle's U.S. Businesses Data Dictionary\n-   Verified Businesses in Sharswood Neighborhood\n-   Unverified Businesses in Sharswood Neighborhood\n-   Philadelphia census tracts and neighborhood boundaries\n\n\n::: {.cell progress='hide'}\n\n```{.r .cell-code}\n# Load required packages\nlibrary(tidyverse)\nlibrary(tidycensus)\nlibrary(janitor)\nlibrary(sf)\nlibrary(tigris)\nlibrary(scales)\nlibrary(patchwork)\nlibrary(RColorBrewer)\nlibrary(units)\nlibrary(knitr)\nlibrary(caret)\nlibrary(tidygeocoder)\nlibrary(cowplot)\n```\n:::\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load Data Axle Data\n# data dictionary\ndatadict <- read_csv(\"data/Data_Dict.csv\")\ndatadict\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 133 × 2\n   `Field Name`         `Field Description`                                     \n   <chr>                <chr>                                                   \n 1 Company Name         Name of Company or Professional Name                    \n 2 Executive First Name First Name of Contact                                   \n 3 Executive Last Name  Last Name of Contact                                    \n 4 Address              Location address of the company                         \n 5 City                 Location city address of the company                    \n 6 State                Location state address of the company                   \n 7 ZIP Code             Location zip code address of the company                \n 8 Record Type          Type of record - Verified, Unverified, Closed or Out of…\n 9 Professional Title   Professional title of contact on executive detail - if …\n10 Executive Title      Title of contact on Executive Detail                    \n# ℹ 123 more rows\n```\n\n\n:::\n\n```{.r .cell-code}\n# verified businesses\nverified <- read_csv(\"data/Sharswood_Verified_Biz.csv\")\n\n# merge unverified businesses due to download limits from DataAxle\nunverified1 <- read_csv(\"data/Sharswood_Unverified_Biz_Pg1to10.csv\")\nunverified2 <- read_csv(\"data/Sharswood_Unverified_Biz_Pg11to17.csv\")\nunverified_combined <- bind_rows(unverified1, unverified2)\nwrite_csv(unverified_combined, \"data/Sharswood_Unverified_Biz_Combined.csv\")\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# rename column headings\nverified <- verified |> clean_names()\nunverified_combined <- unverified_combined |> clean_names()\n\n# filter out small businesses with irrelevant SIC Codes\ndrop_SIC <- c(\"Atm-Automated Teller Machines\", \"Schools\", \"Churches\", \n              \"Nonclassified Establishments\", \"Real Estate Management\", \n              \"Townhouses\", \"Mailing & Shipping Kiosks\", \n              \"Offices Of Real Estate Agents And Brokers\", \"Real Estate\")\n\nverified_clean <- verified |>\n  filter(!primary_sic_description %in% drop_SIC) |>\n  select(company_name, address, latitude, longitude, census_block_group, \n         primary_sic_code, primary_sic_description, primary_naics, \n         primary_naics_description, years_in_database, \n         location_type, location_employee_size_range, \n         square_footage, record_type)\n\nunverified_clean <- unverified_combined |>\n  filter(!primary_sic_description %in% drop_SIC) |>\n  select(company_name, address, latitude, longitude, census_block_group, \n         primary_sic_code, primary_sic_description, primary_naics, \n         primary_naics_description, years_in_database, \n         location_type, location_employee_size_range, \n         square_footage, record_type)\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load spatial data\ncensus_tracts <- tracts(state = \"PA\", county = \"Philadelphia\", year = 2020, \n                        class = \"sf\", cb = TRUE, progress = FALSE)\nblock_grps <- block_groups(state = \"PA\", county = \"Philadelphia\", year = 2020, \n                           class = \"sf\", cb = TRUE, progress = FALSE)\n```\n:::\n\n\n--------------------------------------------------------------------------------\n\n### Step 2: Get Philadelphia Demographic Data using `tidycensus`\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load all available variables for ACS 5-year 2022\nacs_vars_2022 <- load_variables(2022, \"acs5\", cache = TRUE)\n```\n:::\n\n\n\n::: {.cell progress='hide'}\n\n```{.r .cell-code}\n# Get tract-level demographic data from 2022 ACS 5-Yr Estimates for Philadelphia\nphl_tract_data <- get_acs(\n  geography = \"tract\",\n  variables = c(\n    total_pop = \"B01003_001\",\n    median_income = \"B19013_001\",\n    poverty = \"B17001_001\",\n    White     = \"B03002_003\",\n    Black     = \"B03002_004\",\n    Hispanic  = \"B03002_012\"\n  ),\n  state = \"PA\",\n  county = \"Philadelphia\",\n  year = 2022,\n  survey = \"acs5\",\n  output = \"wide\",\n  geometry = TRUE\n)\n\n# Clean the county names to remove state name and \"County\" \nphl_tract_clean <- phl_tract_data |> \n  separate(\n    NAME, \n    into = c(\"tract_name\", \"county_name\", \"state_name\"), \n    sep = \"; \"\n  ) |> \n  mutate(\n    tract_name = str_remove(tract_name, \"Census Tract \"),\n    county_name = str_remove(county_name, \" County\")\n  )\n\nphl_tract_summary <- phl_tract_clean |>\n  select(GEOID, tract_name, county_name, total_popE, median_incomeE)\n```\n:::\n\n\n--------------------------------------------------------------------------------\n\n### Step 3: Make Data Axle dataset Spatial\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Convert Data Axle dataset to sf object\nverified.sf <- verified_clean |> \n  st_as_sf(coords = c(\"longitude\", \"latitude\"), crs = 4326) |> # WGS 84 \n  st_transform(2272) # PA State Plane (in US Survey Feet)\n\nunverified.sf <- unverified_clean |> \n  st_as_sf(coords = c(\"longitude\", \"latitude\"), crs = 4326) |> \n  st_transform(2272)\n```\n:::\n\n\n**Join Data Axle Shapefiles to Philadelphia Cenus Tracts and Block Groups**\n\n\n::: {.cell progress='hide'}\n\n```{.r .cell-code}\nsharswood_parcels <- st_read(\"data/sharswood_parcels.geojson\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nReading layer `sharswood_parcels' from data source \n  `C:\\Users\\chewj\\Documents\\MUSA\\Github\\portfolio-setup-jedchewjm\\side-hustles\\data\\sharswood_parcels.geojson' \n  using driver `GeoJSON'\nSimple feature collection with 3709 features and 40 fields\nGeometry type: GEOMETRY\nDimension:     XY\nBounding box:  xmin: -75.18063 ymin: 39.97128 xmax: -75.16626 ymax: 39.97991\nGeodetic CRS:  WGS 84\n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Filter Census Tracts for Sharswood\nsharswood_tract_sf <- phl_tract_summary |> \n  filter(tract_name == c(\"138\", \"139\"))\n\n# Filter Block Groups for Sharswood\nids <- c(\"421010138001\",\"421010138002\",\"421010139001\",\n         \"421010139002\",\"421010139003\")\n\nsharswood_bg_sf <- block_grps |>\n filter(GEOID %in% ids)\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Join Shapefiles and Plot Map\nsharswood_bg_sf <- st_transform(sharswood_bg_sf, st_crs(verified.sf))\n\nggplot() +\n  geom_sf(data = sharswood_parcels, fill = \"gray97\", \n          color = \"gray50\", linewidth = 0.3) +\n  geom_sf(data = verified.sf, aes(fill = primary_sic_description), \n          shape = 21, size = 2, alpha = 0.9) +\n  labs(\n    title = \"Current Businesses in Sharswood\",\n    subtitle = \"Verified by Data Axle\",\n    fill = \"SIC Description\"\n  ) +\n  theme_void()\n```\n\n::: {.cell-output-display}\n![](dataaxle_biz_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n\n```{.r .cell-code}\nggplot() +\n  geom_sf(data = sharswood_parcels, fill = \"gray97\", \n          color = \"gray50\", linewidth = 0.3) +\n  geom_sf(data = unverified.sf, shape = 21, size = 2, \n          fill = \"black\", alpha = 0.9) +\n  labs(\n    title = \"Unverified Businesses in Sharswood — Data Axle\",\n    subtitle = \"PA South State Plane (ftUS)\",\n    caption = paste0(\"CRS: \", \n                     st_crs(block_grps)$input %||% st_crs(block_grps)$epsg)\n  ) +\n  theme_void()\n```\n\n::: {.cell-output-display}\n![](dataaxle_biz_files/figure-html/unnamed-chunk-11-2.png){width=672}\n:::\n:::\n\n\n--------------------------------------------------------------------------------\n\n### Step 4: Map Businesses to Property Parcels and Affordable Housing Projects\n\n-   Data Source: Philadelphia Department of Records Property Parcels\n-   Date Downloaded: Oct 19, 2025\n-   Link:\n    <https://opendataphilly.org/datasets/department-of-records-property-parcels/>\n\n\n::: {.cell progress='hide'}\n\n```{.r .cell-code}\nggplot() +\n  geom_sf(data = sharswood_bg_sf, fill = \"gray97\", \n          color = \"gray50\", linewidth = 0.3) +\n  geom_sf(data = sharswood_parcels, fill = NA, color = \"gray50\", linewidth = 0.6) +\n  labs(title = \"Property Parcels in Sharswood\") +\n  theme_void()\n```\n\n::: {.cell-output-display}\n![](dataaxle_biz_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\n-   Data Source: Philadlephia Division of Housing and Community Development\n    (DHCD)\n-   Date Downloaded: Oct 19, 2025\n-   Link: <https://opendataphilly.org/datasets/affordable-housing-production/>\n\n\n::: {.cell}\n\n```{.r .cell-code}\naffordable_housing_parcels <- st_read(\"data/Affordable_housing.geojson\") |>\n  st_transform(st_crs(sharswood_bg_sf))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nReading layer `Affordable_Housing' from data source \n  `C:\\Users\\chewj\\Documents\\MUSA\\Github\\portfolio-setup-jedchewjm\\side-hustles\\data\\Affordable_Housing.geojson' \n  using driver `GeoJSON'\nreplacing null geometries with empty geometries\nSimple feature collection with 484 features and 12 fields (with 22 geometries empty)\nGeometry type: POINT\nDimension:     XY\nBounding box:  xmin: -75.2489 ymin: 39.90183 xmax: -74.9829 ymax: 40.12171\nGeodetic CRS:  WGS 84\n```\n\n\n:::\n\n```{.r .cell-code}\n# Spatial Filter for Affordable Housing Units in Sharswood\nsharswood_affordable <- st_filter(affordable_housing_parcels, sharswood_bg_sf, \n                                  .predicate = st_within)\n\nggplot() +\n  geom_sf(data = sharswood_bg_sf, fill = \"gray97\", \n          color = \"gray50\", linewidth = 0.3) +\n  geom_sf(data = sharswood_affordable, aes(size = total_units), \n          fill = NA, color = \"firebrick\", linewidth = 0.6) +\n  geom_sf_text(data = sharswood_affordable, aes(label = project_name),\n               size = 2, check_overlap = TRUE) +\n  labs(title = \"Affordable Housing Projects in Sharswood (1994–2024)\") +\n  theme_void()\n```\n\n::: {.cell-output-display}\n![](dataaxle_biz_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n\n**Putting it All Together**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  geom_sf(data = sharswood_bg_sf, fill = \"gray97\", \n          color = \"gray50\", linewidth = 0.3) +\n  geom_sf(data = sharswood_parcels, fill = NA, color = \"gray50\", linewidth = 0.6) +\n  geom_sf(data = sharswood_affordable, fill = NA, \n          color = \"firebrick\", linewidth = 1) +\n  geom_sf_text(data = sharswood_affordable, aes(label = project_name),\n               size = 3, check_overlap = TRUE) +\n  geom_sf(data = verified.sf, fill = \"blue\", shape = 21, size = 1.5, alpha = 0.9) +\n  geom_sf(data = unverified.sf, fill = \"darkgreen\", \n          shape = 21, size = 1.5, alpha = 0.9) +\n  labs(title = \"Businesses and Affordable Housing Projects in Sharswood\") +\n  theme_void()\n```\n\n::: {.cell-output-display}\n![](dataaxle_biz_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n:::\n\n\n--------------------------------------------------------------------------------\n\n### Step 5: Merge Verified and Unverified Datasets\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsharswood_curr_biz <- bind_rows(verified_clean, unverified_clean)\ncount(sharswood_curr_biz, primary_sic_description)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 100 × 2\n   primary_sic_description                  n\n   <chr>                                <int>\n 1 Advertising-Computer                     1\n 2 Agricultural Products                    1\n 3 Apartments                               2\n 4 Appliances-Household-Major-Repairing     1\n 5 Art Galleries & Dealers                  1\n 6 Arts Organizations & Information         1\n 7 Associations                             3\n 8 Automobile Clubs                         1\n 9 Automobile Dealers-New Cars              2\n10 Barbers                                  6\n# ℹ 90 more rows\n```\n\n\n:::\n\n```{.r .cell-code}\ncount(sharswood_curr_biz, primary_naics_description)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 88 × 2\n   primary_naics_description                              n\n   <chr>                                              <int>\n 1 Administrative Management And General Management C     1\n 2 All Other General Merchandise Retailers                1\n 3 All Other Miscellaneous Ambulatory Health Care Ser     1\n 4 All Other Miscellaneous Crop Farming                   1\n 5 All Other Personal Services                            2\n 6 All Other Professional, Scientific, And Technical      6\n 7 All Other Publishers                                   1\n 8 All Other Specialty Trade Contractors                  1\n 9 All Other Support Services                             2\n10 All Other Telecommunications                           1\n# ℹ 78 more rows\n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Make Combined Dataset Spatial\nsharswood_curr_biz.sf <- sharswood_curr_biz |> \n  st_as_sf(coords = c(\"longitude\", \"latitude\"), crs = 4326) |> # WGS 84 \n  st_transform(2272) # PA State Plane (in US Survey Feet)\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  geom_sf(data = sharswood_parcels, fill = NA, color = \"gray50\", linewidth = 0.6) +\n  geom_sf(data = sharswood_curr_biz.sf, fill = \"darkgreen\", \n          shape = 21, size = 1.5, alpha = 0.9) +\n  labs(title = \"Current Businesses in Sharswood\") +\n  theme_void()\n```\n\n::: {.cell-output-display}\n![](dataaxle_biz_files/figure-html/unnamed-chunk-18-1.png){width=672}\n:::\n:::\n\n\n--------------------------------------------------------------------------------\n\n## Part 2: Repeat Steps for 2012, 2017, and 2022\n\n--------------------------------------------------------------------------------\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Further Cleaning\ndrop_SIC_2 <- c(\"Apartments\", \"Housing Authorities\", \n                \"Office Buildings & Parks\",\n                \"Schools-Universities & Colleges Academic\",\n                \"Gardens\", \"Dialysis\",\n                \"City Government-Housing Programs\")\n```\n:::\n\n\n### 2012 Data Axle Business Records\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load in 2012 Data\ndataaxle2012 <- read_csv(\"data/2012_combined.csv\") |> \n  clean_names()\n\ndataaxle2012_clean <- dataaxle2012 |>\n  filter(!primary_sic_description %in% drop_SIC) |> \n  mutate(address = str_c(address, \"Philadelphia\", \"PA 19121\", sep = \", \"))\n\n# Geocode\ndataaxle2012_geo <- dataaxle2012_clean |> \n  geocode(address, method = 'osm', lat = latitude, long = longitude)\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite_csv(dataaxle2012_geo, \"data/Sharswood_Biz_2012_geo.csv\")\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Convert Data Axle dataset to sf object\ndataaxle2012.sf <- read_csv(\"data/Sharswood_Biz_2012_geo.csv\") |> \n  filter(!primary_sic_description %in% drop_SIC_2) |> \n  drop_na(longitude, latitude) |>\n  st_as_sf(coords = c(\"longitude\", \"latitude\"), crs = 4326, remove = FALSE) |>\n  st_transform(2272)\n\ndataaxle2012.sf <- dataaxle2012.sf |> \n  st_transform(st_crs(sharswood_bg_sf)) |> \n  st_crop(sharswood_bg_sf) |> \n  st_filter(sharswood_bg_sf, .predicate = st_within)\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncount(dataaxle2012.sf, primary_sic_description)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSimple feature collection with 28 features and 2 fields\nGeometry type: GEOMETRY\nDimension:     XY\nBounding box:  xmin: 2688851 ymin: 243870.1 xmax: 2692156 ymax: 245846.9\nProjected CRS: NAD83 / Pennsylvania South (ftUS)\n# A tibble: 28 × 3\n   primary_sic_description                  n                           geometry\n * <chr>                                <int>        <GEOMETRY [US_survey_foot]>\n 1 Appliances-Household-Major-Repairing     1           POINT (2692156 244122.7)\n 2 Associations                             1           POINT (2689474 245276.8)\n 3 Automobile Repairing & Service           3 MULTIPOINT ((2689177 244301.3), (…\n 4 Barbers                                  2 MULTIPOINT ((2689603 244468.7), (…\n 5 Beer & Ale-Wholesale                     1           POINT (2691662 244896.7)\n 6 Check Cashing Service                    2 MULTIPOINT ((2690151 245846.9), (…\n 7 Child Care Service                       1           POINT (2689082 244784.5)\n 8 Clinics                                  1           POINT (2688851 244153.3)\n 9 Clubs                                    1           POINT (2691632 245047.6)\n10 Economic Research & Analysis             1           POINT (2690287 244384.2)\n# ℹ 18 more rows\n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Plot with Formatted Legend\np_2012 <- ggplot() +\n  geom_sf(data = sharswood_parcels, fill = \"gray97\",\n          color = \"gray60\", linewidth = 0.3) +\n  geom_sf(data = dataaxle2012.sf,\n          aes(fill = primary_sic_description),\n          shape = 21, size = 2, alpha = 0.9, color = \"gray30\") +\n  labs(\n    title = \"2012 Businesses in Sharswood\",\n    subtitle = \"Verified by Data Axle\",\n    fill = \"SIC Description\"\n  ) +\n  theme_void() +\n  theme(\n    legend.position = \"bottom\",\n    theme(legend.title = element_blank()),\n    legend.text  = element_text(size = 8),\n    legend.key.size = unit(0.5, \"lines\"),\n    # legend.box.margin = margin(t = 12),     # space above legend\n    plot.margin = margin(12, 16, 50, 16),   # extra bottom margin for legend\n    plot.title = element_text(size = 14, face = \"bold\", hjust = 0.5),\n    plot.subtitle = element_text(size = 12, hjust = 0.5)\n  ) +\n  guides(fill = guide_legend(title = NULL, ncol = 4, byrow = TRUE,\n                             override.aes = list(size = 3)))\n\n# Make the plotting area “regular size”\np_2012 + plot_layout(heights = c(1))  # (device size controls final size)\n```\n\n::: {.cell-output-display}\n![](dataaxle_biz_files/figure-html/unnamed-chunk-24-1.png){width=672}\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggsave(\"sharswood_2012.png\", p_2012, width = 10, height = 7, dpi = 300)\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  geom_sf(data = sharswood_parcels, fill = NA, color = \"gray50\", linewidth = 0.6) +\n  geom_sf(data = dataaxle2012.sf, fill = \"darkgreen\", \n          shape = 21, size = 1, alpha = 0.9) +\n  labs(title = \"2012 Verified Businesses in Sharswood\",\n       caption = \"Data Source: Data Axle U.S. Historical Businesses\") +\n  theme_void()\n```\n\n::: {.cell-output-display}\n![](dataaxle_biz_files/figure-html/unnamed-chunk-26-1.png){width=672}\n:::\n:::\n\n\n--------------------------------------------------------------------------------\n\n### 2017 Data Axle Business Records\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load in 2017 Data\ndataaxle2017 <- read_csv(\"data/2017_combined.csv\") |> \n  clean_names()\n\ndataaxle2017_clean <- dataaxle2017 |>\n  filter(!primary_sic_description %in% drop_SIC) |> \n  mutate(address = str_c(address, \"Philadelphia\", \"PA 19121\", sep = \", \"))\n\n# Geocode\ndataaxle2017_geo <- dataaxle2017_clean |> \n  geocode(address, method = 'osm', lat = latitude, long = longitude)\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite_csv(dataaxle2017_geo, \"data/Sharswood_Biz_2017_geo.csv\")\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Convert Data Axle dataset to sf object\ndataaxle2017.sf <- read_csv(\"data/Sharswood_Biz_2017_geo.csv\") |> \n  filter(!primary_sic_description %in% drop_SIC_2) |> \n  drop_na(longitude, latitude) |>\n  st_as_sf(coords = c(\"longitude\", \"latitude\"), crs = 4326, remove = FALSE) |>\n  st_transform(2272)\n\n# Spatial Filter\ndataaxle2017.sf <- dataaxle2017.sf |> \n  st_transform(st_crs(sharswood_bg_sf)) |> \n  st_crop(sharswood_bg_sf) |> \n  st_filter(sharswood_bg_sf, .predicate = st_within)\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncount(dataaxle2017.sf, primary_sic_description)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSimple feature collection with 19 features and 2 fields\nGeometry type: GEOMETRY\nDimension:     XY\nBounding box:  xmin: 2689066 ymin: 243870.1 xmax: 2691899 ymax: 245888.3\nProjected CRS: NAD83 / Pennsylvania South (ftUS)\n# A tibble: 19 × 3\n   primary_sic_description            n                                 geometry\n * <chr>                          <int>              <GEOMETRY [US_survey_foot]>\n 1 Associations                       1                 POINT (2689474 245276.8)\n 2 Automobile Repairing & Service     3 MULTIPOINT ((2689177 244301.3), (269145…\n 3 Barbers                            2 MULTIPOINT ((2689603 244468.7), (268985…\n 4 Beauty Salons                      1                 POINT (2691863 244474.9)\n 5 Beer & Ale-Wholesale               1                 POINT (2691662 244896.7)\n 6 Child Care Service                 1                 POINT (2691324 245410.4)\n 7 Clubs                              1                 POINT (2691632 245047.6)\n 8 Computers-Networking               1                 POINT (2691784 244674.2)\n 9 Computers-Service & Repair         1                 POINT (2691347 245656.3)\n10 Counselors                         1                 POINT (2691446 243870.1)\n11 Electric Contractors               1                 POINT (2689374 245694.9)\n12 Grocers-Retail                     2 MULTIPOINT ((2691432 244656.9), (269184…\n13 License Services                   1                 POINT (2691784 244674.2)\n14 Pet Washing & Grooming             1                   POINT (2689066 244695)\n15 Recreation Centers                 1                 POINT (2689137 245013.4)\n16 Restaurants                        2 MULTIPOINT ((2691208 245696.7), (269185…\n17 Salvage & Surplus Merchandise      1                 POINT (2689374 245694.9)\n18 Travel Agencies & Bureaus          1                 POINT (2691436 245074.3)\n19 Trucking                           1                 POINT (2689566 245888.3)\n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Map\nggplot() +\n  geom_sf(data = sharswood_parcels, fill = NA, color = \"gray50\", linewidth = 0.6) +\n  geom_sf(data = dataaxle2017.sf, fill = \"darkgreen\", \n          shape = 21, size = 1, alpha = 0.9) +\n  labs(title = \"2017 Verified Businesses in Sharswood\",\n       caption = \"Data Source: Data Axle U.S. Historical Businesses\") +\n  theme_void()\n```\n\n::: {.cell-output-display}\n![](dataaxle_biz_files/figure-html/unnamed-chunk-31-1.png){width=672}\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Plot with Formatted Legend\np_2017 <- ggplot() +\n  geom_sf(data = sharswood_parcels, fill = \"gray97\",\n          color = \"gray60\", linewidth = 0.3) +\n  geom_sf(data = dataaxle2017.sf,\n          aes(fill = primary_sic_description),\n          shape = 21, size = 2, alpha = 0.9, color = \"gray30\") +\n  labs(\n    title = \"2017 Businesses in Sharswood\",\n    subtitle = \"Verified by Data Axle\",\n    fill = \"SIC Description\"\n  ) +\n  theme_void() +\n  theme(\n    legend.position = \"bottom\",\n    theme(legend.title = element_blank()),\n    legend.text  = element_text(size = 8),\n    legend.key.size = unit(0.5, \"lines\"),\n    legend.box.margin = margin(t = 2),     # space above legend\n    plot.margin = margin(12, 16, 50, 16),   # extra bottom margin for legend\n    plot.title = element_text(size = 14, face = \"bold\", hjust = 0.5),\n    plot.subtitle = element_text(size = 12, hjust = 0.5)\n  ) +\n  guides(fill = guide_legend(title = NULL, ncol = 4, byrow = TRUE,\n                             override.aes = list(size = 3)))\n\n# Make the plotting area “regular size”\np_2017 + plot_layout(heights = c(1))  # (device size controls final size)\n```\n\n::: {.cell-output-display}\n![](dataaxle_biz_files/figure-html/unnamed-chunk-32-1.png){width=672}\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggsave(\"sharswood_2017.png\", p_2017, width = 10, height = 7, dpi = 300)\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  geom_sf(data = sharswood_parcels, fill = \"gray97\", \n          color = \"gray50\", linewidth = 0.3) +\n  geom_sf(data = dataaxle2017.sf, aes(fill = primary_sic_description), \n          shape = 21, size = 2, alpha = 0.9) +\n  labs(\n    title = \"2017 Businesses in Sharswood\",\n    subtitle = \"Verified by Data Axle\",\n    fill = \"SIC Description\"\n  ) +\n  theme_void()\n```\n\n::: {.cell-output-display}\n![](dataaxle_biz_files/figure-html/unnamed-chunk-34-1.png){width=672}\n:::\n:::\n\n\n--------------------------------------------------------------------------------\n\n### 2022 Data Axle Business Records\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load in 2022 Data\ndataaxle2022 <- read_csv(\"data/2022_combined.csv\") |> \n  clean_names()\n\ndataaxle2022_clean <- dataaxle2022 |>\n  filter(!primary_sic_description %in% drop_SIC) |> \n  mutate(address = str_c(address, \"Philadelphia\", \"PA 19121\", sep = \", \"))\n\n# Geocode\ndataaxle2022_geo <- dataaxle2022_clean |> \n  geocode(address, method = 'osm', lat = latitude, long = longitude)\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite_csv(dataaxle2022_geo, \"data/Sharswood_Biz_2022_geo.csv\")\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Convert Data Axle dataset to sf object\ndataaxle2022.sf <- read_csv(\"data/Sharswood_Biz_2022_geo.csv\") |> \n  filter(!primary_sic_description %in% drop_SIC_2) |> \n  drop_na(longitude, latitude) |>\n  st_as_sf(coords = c(\"longitude\", \"latitude\"), crs = 4326, remove = FALSE) |>\n  st_transform(2272)\n\n# Spatial Filter\ndataaxle2022.sf <- dataaxle2022.sf |> \n  st_transform(st_crs(sharswood_bg_sf)) |> \n  st_crop(sharswood_bg_sf) |> \n  st_filter(sharswood_bg_sf, .predicate = st_within)\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncount(dataaxle2022.sf, primary_sic_description)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSimple feature collection with 23 features and 2 fields\nGeometry type: GEOMETRY\nDimension:     XY\nBounding box:  xmin: 2688734 ymin: 243603 xmax: 2691925 ymax: 245888.3\nProjected CRS: NAD83 / Pennsylvania South (ftUS)\n# A tibble: 23 × 3\n   primary_sic_description            n                                 geometry\n * <chr>                          <int>              <GEOMETRY [US_survey_foot]>\n 1 Associations                       1                 POINT (2689474 245276.8)\n 2 Automobile Repairing & Service     3 MULTIPOINT ((2689177 244301.3), (269145…\n 3 Barbers                            1                 POINT (2689603 244468.7)\n 4 Beauty Salons                      1                 POINT (2691863 244474.9)\n 5 Beer & Ale-Wholesale               1                 POINT (2691662 244896.7)\n 6 Carpenters                         1                 POINT (2691701 244688.5)\n 7 Clubs                              1                 POINT (2689566 245888.3)\n 8 Computers-Networking               1                 POINT (2691784 244674.2)\n 9 Condiments & Sauces (Whls)         1                 POINT (2691347 245656.3)\n10 Construction Companies             1                 POINT (2691624 245213.5)\n# ℹ 13 more rows\n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Map\nggplot() +\n  geom_sf(data = sharswood_parcels, fill = NA, color = \"gray50\", linewidth = 0.6) +\n  geom_sf(data = dataaxle2022.sf, fill = \"darkgreen\", \n          shape = 21, size = 1, alpha = 0.9) +\n  labs(title = \"2022 Verified Businesses in Sharswood\",\n       caption = \"Data Source: Data Axle U.S. Historical Businesses\") +\n  theme_void()\n```\n\n::: {.cell-output-display}\n![](dataaxle_biz_files/figure-html/unnamed-chunk-39-1.png){width=672}\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Plot with Formatted Legend\np_2022 <- ggplot() +\n  geom_sf(data = sharswood_parcels, fill = \"gray97\",\n          color = \"gray60\", linewidth = 0.3) +\n  geom_sf(data = dataaxle2022.sf,\n          aes(fill = primary_sic_description),\n          shape = 21, size = 2, alpha = 0.9, color = \"gray30\") +\n  labs(\n    title = \"2022 Businesses in Sharswood\",\n    subtitle = \"Verified by Data Axle\",\n    fill = \"SIC Description\"\n  ) +\n  theme_void() +\n  theme(\n    legend.position = \"bottom\",\n    theme(legend.title = element_blank()),\n    legend.text  = element_text(size = 8),\n    legend.key.size = unit(0.5, \"lines\"),\n    legend.box.margin = margin(t = 2),     # space above legend\n    plot.margin = margin(12, 16, 50, 16),   # extra bottom margin for legend\n    plot.title = element_text(size = 14, face = \"bold\", hjust = 0.5),\n    plot.subtitle = element_text(size = 12, hjust = 0.5)\n  ) +\n  guides(fill = guide_legend(title = NULL, ncol = 4, byrow = TRUE,\n                             override.aes = list(size = 3)))\n\n# Make the plotting area “regular size”\np_2022 + plot_layout(heights = c(1))  # (device size controls final size)\n```\n\n::: {.cell-output-display}\n![](dataaxle_biz_files/figure-html/unnamed-chunk-40-1.png){width=672}\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggsave(\"sharswood_2022.png\", p_2022, width = 10, height = 7, dpi = 300)\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  geom_sf(data = sharswood_parcels, fill = \"gray97\", \n          color = \"gray50\", linewidth = 0.3) +\n  geom_sf(data = dataaxle2022.sf, aes(fill = primary_sic_description), \n          shape = 21, size = 2, alpha = 0.9) +\n  labs(\n    title = \"2022 Businesses in Sharswood\",\n    subtitle = \"Verified by Data Axle\",\n    fill = \"SIC Description\"\n  ) +\n  theme_void()\n```\n\n::: {.cell-output-display}\n![](dataaxle_biz_files/figure-html/unnamed-chunk-42-1.png){width=672}\n:::\n:::\n\n\n--------------------------------------------------------------------------------\n\n### Current Businesses in Sharswood\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Plot with Formatted Legend\np_curr <- ggplot() +\n  geom_sf(data = sharswood_parcels, fill = \"gray97\",\n          color = \"gray60\", linewidth = 0.3) +\n  geom_sf(data = verified.sf,\n          aes(fill = primary_sic_description),\n          shape = 21, size = 2, alpha = 0.9, color = \"gray30\") +\n  labs(\n    title = \"Current Businesses in Sharswood\",\n    subtitle = \"Verified by Data Axle\",\n    fill = \"SIC Description\"\n  ) +\n  theme_void() +\n  theme(\n    legend.position = \"bottom\",\n    theme(legend.title = element_blank()),\n    legend.text  = element_text(size = 8),\n    legend.key.size = unit(0.5, \"lines\"),\n    legend.box.margin = margin(t = 2),     # space above legend\n    plot.margin = margin(12, 16, 50, 16),   # extra bottom margin for legend\n    plot.title = element_text(size = 14, face = \"bold\", hjust = 0.5),\n    plot.subtitle = element_text(size = 12, hjust = 0.5)\n  ) +\n  guides(fill = guide_legend(title = NULL, ncol = 4, byrow = TRUE,\n                             override.aes = list(size = 3)))\n\n# Make the plotting area “regular size”\np_curr + plot_layout(heights = c(1))  # (device size controls final size)\n```\n\n::: {.cell-output-display}\n![](dataaxle_biz_files/figure-html/unnamed-chunk-43-1.png){width=672}\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggsave(\"sharswood_curr.png\", p_curr, width = 10, height = 7, dpi = 300)\n```\n:::\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}