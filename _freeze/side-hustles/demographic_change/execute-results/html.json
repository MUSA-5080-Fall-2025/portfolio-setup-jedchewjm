{
  "hash": "ae3b8707e937148df82a7cb7516edf6a",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Demographic Changes at Census Tract Level - Sharswood\"\nsubtitle: \"URBS 4000: Urban Studies Thesis\"\nauthor: \"Jed Chew\"\ndate: today\nformat: \n  html:\n    code-fold: false\n    toc: true\n    toc-location: left\n    theme: cosmo\n    embed-resources: true\nexecute:\n  warning: false\n  message: false\neditor: \n  markdown: \n    wrap: 80\n---\n\n## Project Title: Mixed by Design\n\n### *A Case Study of the Philadelphia Housing Authority's (PHA) Choice Neighborhoods Redevelopment of Sharswood*\n\nFor my Urban Studies thesis, I am researching the PHA's Choice Neighborhoods\nredevelopment of the Sharswood neighborhood in North Philadelphia. I have two\nmain research questions about the process and outcome of this redevelopment:\n\n\\(1\\) the **process** by which the PHA aligned the politics, finance, and design\nfor the redevelopment of Sharswood; andÂ \n\n\\(2\\) the early redevelopment **outcomes** relative to the Choice Neighborhoods\nInitiative (CNI) vision of mixed-partners, mixed-use, and mixed-income\n\n## Part 1: ACS Data\n\n**American Community Survey (ACS) Estimates**\n\nThe first ACS 5-year estimate was released in late 2010 as a replacement of the\nlongform decennial Census. Every year, the ACS surveys about 1 in 40 housing\nunits to produce 1-year estimates, but these housing units must not have been\nsurveyed in the previous five years. Hence, the 5-year estimate incorporates\nfive years of non-overlapping data (approximately 1 in 8 housing units) to\nrecreate the longform of the decennial census.\n\nIn this exploratory data analysis, I used three separate (i.e. no overlapping\nyears) ACS 5-year estimates to provide pre- and post-redevelopment snapshots:\n2009-2012, 2013-17, and 2018-2022.\n\nThere are two main limitations with this methodology:\n\n1.  The census tracts do not align exactly with the boundaries of the Sharswood\n    redevelopment area\n2.  5-year estimates also smooth out significant redevelopment events over\n    multiple years, and it is challenging to identify the critical junctures in\n    the redevelopment process and their direct impact on the neighborhood\n\n### Step 1: Load Raw Data as csv files\n\n-   Philadelphia census tracts, block groups, and neighborhood boundaries\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load spatial data\ncensus_tracts <- tracts(state = \"PA\", county = \"Philadelphia\", year = 2020, class = \"sf\", cb = TRUE, progress = FALSE)\nblock_grps <- block_groups(state = \"PA\", county = \"Philadelphia\", year = 2020, class = \"sf\",cb = TRUE, progress = FALSE)\n\n# Standardize CRS\n```\n:::\n\n\n--------------------------------------------------------------------------------\n\n### Step 2: Get Philadelphia Demographic Data using `tidycensus`\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load all available variables for ACS 5-year 2022\nacs_vars_2022 <- load_variables(2022, \"acs5\", cache = TRUE)\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Helper Variables for Summing Population Values for Children aged 5-19\nchild_pop = c(\"B01001_004\", \"B01001_005\", \"B01001_006\", \"B01001_007\", \n                \"B01001_028\", \"B01001_029\", \"B01001_030\", \"B01001_031\")\n\n\n# Helper Variable for Summing Population Values for Elderly Population\nelderly_pop = c(\"B01001_020\", \"B01001_021\", \"B01001_022\", \"B01001_023\", \n                \"B01001_024\", \"B01001_025\", \n                \"B01001_044\", \"B01001_045\", \"B01001_046\", \n                \"B01001_047\", \"B01001_048\", \"B01001_049\")\n\n# Get tract-level demographic data from 2022 ACS 5-Yr Estimates for Philadelphia\nphl_tract_2022_data <- get_acs(\n  geography = \"tract\",\n  variables = c(\n    total_pop = \"B01003_001\",\n    child_pop = child_pop,\n    elderly_pop = elderly_pop,\n    median_income = \"B19013_001\",\n    poverty = \"B17001_001\",\n    White     = \"B03002_003\",\n    Black     = \"B03002_004\",\n    Hispanic  = \"B03002_012\"\n  ),\n  state = \"PA\",\n  county = \"Philadelphia\",\n  year = 2022,\n  survey = \"acs5\",\n  output = \"wide\",\n  geometry = TRUE\n)\n\n# Clean the county names to remove state name and \"County\" \nphl_tract_2022_clean <- phl_tract_2022_data |> \n  separate(\n    NAME, \n    into = c(\"tract_name\", \"county_name\", \"state_name\"), \n    sep = \"; \"\n  ) |> \n  mutate(\n    tract_name = str_remove(tract_name, \"Census Tract \"),\n    county_name = str_remove(county_name, \" County\")\n  )\n\nphl_tract_2022_summary <- phl_tract_2022_clean |>\n  mutate(\n    # demographic variables\n    elderly_popE = rowSums(across(matches(\"^elderly_pop\\\\d+E$\")), na.rm = TRUE),\n    # for MOE, ACS guidance is to combine by quadrature\n    elderly_popM = sqrt(rowSums(across(matches(\"^elderly_pop\\\\d+M$\"))^2, na.rm = \n                                  TRUE)),\n    pct_elderly = round((elderly_popE / total_popE) *100, 2),\n    child_popE = rowSums(across(matches(\"^child_pop\\\\d+E$\")), na.rm = TRUE),\n    child_popM = sqrt(rowSums(across(matches(\"^child_pop\\\\d+M$\"))^2, \n                              na.rm = TRUE)),\n    pct_child = round((child_popE/total_popE) * 100, 2),\n    # race variables\n    pct_white = round((WhiteE/total_popE) * 100, 2),\n    pct_black = round((BlackE/total_popE) * 100, 2),\n    pct_hispanic = round((HispanicE/total_popE) * 100, 2),\n    \n    pct_poverty = round((povertyE/total_popE)*100, 2)\n  ) |>\n  select(GEOID, tract_name, county_name, total_popE, median_incomeE, elderly_popE, \n         elderly_popM, pct_elderly, child_popE, child_popM, pct_child, pct_poverty,\n         pct_white, pct_black, pct_hispanic)\n```\n:::\n\n\n--------------------------------------------------------------------------------\n\n### Step 3: Filter Data for Sharswood\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Filter Census Tracts for Sharswood\nsharswood_2022_tract_sf <- phl_tract_2022_summary |> \n  filter(tract_name %in% c(\"138\", \"139\"))\n\nsharswood_2022_tract <- sharswood_2022_tract_sf |> \n  st_drop_geometry()\nsharswood_2022_tract\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n        GEOID tract_name  county_name total_popE median_incomeE elderly_popE\n1 42101013800        138 Philadelphia       2077          68864          126\n2 42101013900        139 Philadelphia       2585          41042          391\n  elderly_popM pct_elderly child_popE child_popM pct_child pct_poverty\n1     78.56208        6.07        255   127.1102     12.28      100.00\n2    142.44999       15.13        421   255.5876     16.29       85.18\n  pct_white pct_black pct_hispanic\n1     25.32     59.46         5.83\n2     25.96     51.61        21.08\n```\n\n\n:::\n:::\n\n\n--------------------------------------------------------------------------------\n\n### Step 4: Repeat Process for 2013-2017 ACS 5-Yr Estimates\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Helper Variables for Summing Population Values for Children aged 5-19\nchild_pop = c(\"B01001_004\", \"B01001_005\", \"B01001_006\", \"B01001_007\", \n                \"B01001_028\", \"B01001_029\", \"B01001_030\", \"B01001_031\")\n\n\n# Helper Variable for Summing Population Values for Elderly Population\nelderly_pop = c(\"B01001_020\", \"B01001_021\", \"B01001_022\", \"B01001_023\", \n                \"B01001_024\", \"B01001_025\", \n                \"B01001_044\", \"B01001_045\", \"B01001_046\", \n                \"B01001_047\", \"B01001_048\", \"B01001_049\")\n\n# Get tract-level demographic data from 2022 ACS 5-Yr Estimates for Philadelphia\nphl_2017_tract_data <- get_acs(\n  geography = \"tract\",\n  variables = c(\n    total_pop = \"B01003_001\",\n    child_pop = child_pop,\n    elderly_pop = elderly_pop,\n    median_income = \"B19013_001\",\n    poverty = \"B17001_001\",\n    White     = \"B03002_003\",\n    Black     = \"B03002_004\",\n    Hispanic  = \"B03002_012\"\n  ),\n  state = \"PA\",\n  county = \"Philadelphia\",\n  year = 2017,\n  survey = \"acs5\",\n  output = \"wide\",\n  geometry = TRUE\n)\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Clean the county names to remove state name and \"County\" \nphl_2017_tract_clean <- phl_2017_tract_data |> \n  separate(\n    NAME, \n    into = c(\"tract_name\", \"county_name\", \"state_name\"), \n    sep = \", \"\n  ) |> \n  mutate(\n    tract_name = str_remove(tract_name, \"Census Tract \"),\n    county_name = str_remove(county_name, \" County\")\n  )\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nphl_2017_tract_summary <- phl_2017_tract_clean |>\n  mutate(\n    elderly_popE = rowSums(across(matches(\"^elderly_pop\\\\d+E$\")), na.rm = TRUE),\n    # for MOE, ACS guidance is to combine by quadrature\n    elderly_popM = sqrt(rowSums(across(matches(\"^elderly_pop\\\\d+M$\"))^2, na.rm = \n                                  TRUE)),\n    pct_elderly = round((elderly_popE / total_popE) *100, 2),\n    child_popE = rowSums(across(matches(\"^child_pop\\\\d+E$\")), na.rm = TRUE),\n    child_popM = sqrt(rowSums(across(matches(\"^child_pop\\\\d+M$\"))^2, \n                              na.rm = TRUE)),\n    pct_child = round((child_popE/total_popE) * 100, 2),\n    # race variables\n    pct_white = round((WhiteE/total_popE) * 100, 2),\n    pct_black = round((BlackE/total_popE) * 100, 2),\n    pct_hispanic = round((HispanicE/total_popE) * 100, 2),\n    \n    pct_poverty = round((povertyE/total_popE)*100, 2)\n  ) |>\n  select(GEOID, tract_name, county_name, total_popE, median_incomeE, elderly_popE, \n         elderly_popM, pct_elderly, child_popE, child_popM, pct_child, pct_poverty,\n         pct_white, pct_black, pct_hispanic)\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Filter Census Tracts for Sharswood\nsharswood_2017_tract_sf <- phl_2017_tract_summary |> \n  filter(tract_name == c(\"138\", \"139\"))\n\nsharswood_2017_tract <- sharswood_2017_tract_sf |> \n  st_drop_geometry()\nsharswood_2017_tract\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n        GEOID tract_name  county_name total_popE median_incomeE elderly_popE\n1 42101013900        139 Philadelphia       2603          15028          449\n2 42101013800        138 Philadelphia       1840          27065          211\n  elderly_popM pct_elderly child_popE child_popM pct_child pct_poverty\n1    113.36225       17.25        435   179.5661     16.71       82.56\n2     61.48984       11.47        361   107.6336     19.62       98.37\n  pct_white pct_black pct_hispanic\n1     20.36     68.42         8.34\n2     14.67     74.78         5.38\n```\n\n\n:::\n:::\n\n\n### Step 5: Repeat Process for 2008-2012 ACS 5-Yr Estimates\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Helper Variables for Summing Population Values for Children aged 5-19\nchild_pop = c(\"B01001_004\", \"B01001_005\", \"B01001_006\", \"B01001_007\", \n                \"B01001_028\", \"B01001_029\", \"B01001_030\", \"B01001_031\")\n\n\n# Helper Variable for Summing Population Values for Elderly Population\nelderly_pop = c(\"B01001_020\", \"B01001_021\", \"B01001_022\", \"B01001_023\", \n                \"B01001_024\", \"B01001_025\", \n                \"B01001_044\", \"B01001_045\", \"B01001_046\", \n                \"B01001_047\", \"B01001_048\", \"B01001_049\")\n\n# Get tract-level demographic data from 2022 ACS 5-Yr Estimates for Philadelphia\nphl_2012_tract_data <- get_acs(\n  geography = \"tract\",\n  variables = c(\n    total_pop = \"B01003_001\",\n    child_pop = child_pop,\n    elderly_pop = elderly_pop,\n    median_income = \"B19013_001\",\n    poverty = \"B17001_001\",\n    White     = \"B03002_003\",\n    Black     = \"B03002_004\",\n    Hispanic  = \"B03002_012\"\n  ),\n  state = \"PA\",\n  county = \"Philadelphia\",\n  year = 2012,\n  survey = \"acs5\",\n  output = \"wide\",\n  geometry = TRUE\n)\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Clean the county names to remove state name and \"County\" \nphl_2012_tract_clean <- phl_2012_tract_data |> \n  separate(\n    NAME, \n    into = c(\"tract_name\", \"county_name\", \"state_name\"), \n    sep = \", \"\n  ) |> \n  mutate(\n    tract_name = str_remove(tract_name, \"Census Tract \"),\n    county_name = str_remove(county_name, \" County\")\n  )\n\nphl_2012_tract_summary <- phl_2012_tract_clean |>\n  mutate(\n    elderly_popE = rowSums(across(matches(\"^elderly_pop\\\\d+E$\")), na.rm = TRUE),\n    # for MOE, ACS guidance is to combine by quadrature\n    elderly_popM = sqrt(rowSums(across(matches(\"^elderly_pop\\\\d+M$\"))^2, na.rm = \n                                  TRUE)),\n    pct_elderly = round((elderly_popE / total_popE) *100, 2),\n    child_popE = rowSums(across(matches(\"^child_pop\\\\d+E$\")), na.rm = TRUE),\n    child_popM = sqrt(rowSums(across(matches(\"^child_pop\\\\d+M$\"))^2, \n                              na.rm = TRUE)),\n    pct_child = round((child_popE/total_popE) * 100, 2),\n    # race variables\n    pct_white = round((WhiteE/total_popE) * 100, 2),\n    pct_black = round((BlackE/total_popE) * 100, 2),\n    pct_hispanic = round((HispanicE/total_popE) * 100, 2),\n    \n    pct_poverty = round((povertyE/total_popE)*100, 2)\n  ) |>\n  select(GEOID, tract_name, county_name, total_popE, median_incomeE, elderly_popE, \n         elderly_popM, pct_elderly, child_popE, child_popM, pct_child, pct_poverty,\n         pct_white, pct_black, pct_hispanic)\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Filter Census Tracts for Sharswood\nsharswood_2012_tract_sf <- phl_2012_tract_summary |> \n  filter(tract_name %in% c(\"138\", \"139\"))\n\nsharswood_2012_tract <- sharswood_2012_tract_sf |> \n  st_drop_geometry()\nsharswood_2012_tract\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n        GEOID tract_name  county_name total_popE median_incomeE elderly_popE\n1 42101013800        138 Philadelphia       2026          26500          243\n2 42101013900        139 Philadelphia       3323          15542          419\n  elderly_popM pct_elderly child_popE child_popM pct_child pct_poverty\n1     98.40732       11.99        482   206.3032     23.79      100.00\n2    147.05441       12.61        828   213.2815     24.92       87.93\n  pct_white pct_black pct_hispanic\n1      8.49     82.63         3.11\n2      8.28     85.43         3.37\n```\n\n\n:::\n:::\n\n\n--------------------------------------------------------------------------------\n\n## Part 2: Comprehensive Visualization and Analysis\n\n--------------------------------------------------------------------------------\n\n### Step 1: Rename Columns for ACS Year\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncols_to_suffix <- c(\n  \"total_popE\",\"median_incomeE\",\n  \"elderly_popE\",\"elderly_popM\",\"pct_elderly\",\n  \"child_popE\",\"child_popM\",\"pct_child\", \"pct_poverty\",\n  \"pct_white\", \"pct_black\", \"pct_hispanic\"\n)\n\ns12_sf <- sharswood_2012_tract_sf |>\n  rename_with(~ paste0(.x, \"_2012\"), any_of(cols_to_suffix))\ns12 <- sharswood_2012_tract |>\n  rename_with(~ paste0(.x, \"_2012\"), any_of(cols_to_suffix))\ns17_sf <- sharswood_2017_tract_sf |>\n  rename_with(~ paste0(.x, \"_2017\"), any_of(cols_to_suffix))\ns17 <- sharswood_2017_tract |>\n  rename_with(~ paste0(.x, \"_2017\"), any_of(cols_to_suffix))\ns22_sf <- sharswood_2022_tract_sf |>\n  rename_with(~ paste0(.x, \"_2022\"), any_of(cols_to_suffix))\ns22 <- sharswood_2022_tract |>\n  rename_with(~ paste0(.x, \"_2022\"), any_of(cols_to_suffix))\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncompare_sf <- s12_sf |>\n  select(GEOID, tract_name, county_name, geometry, ends_with(\"_2012\")) |>\n  left_join(select(s17, GEOID, ends_with(\"_2017\")), by = \"GEOID\") |>\n  left_join(select(s22, GEOID, ends_with(\"_2022\")), by = \"GEOID\") |>\n  mutate(\n    pop_change_12_22       = total_popE_2022 - total_popE_2012,\n    pop_pct_change_12_22   = 100 * (total_popE_2022 - total_popE_2012) / pmax(1, total_popE_2012),\n\n    d_pct_child_12_22    = pct_child_2022    - pct_child_2012,\n    d_pct_elderly_12_22  = pct_elderly_2022  - pct_elderly_2012,\n    d_pct_poverty_12_22  = pct_poverty_2022  - pct_poverty_2012,\n    d_pct_white_12_22    = pct_white_2022    - pct_white_2012,\n    d_pct_black_12_22    = pct_black_2022    - pct_black_2012,\n    d_pct_hispanic_12_22 = pct_hispanic_2022 - pct_hispanic_2012,\n\n    d_income_12_17 = median_incomeE_2017 - median_incomeE_2012,\n    d_income_17_22 = median_incomeE_2022 - median_incomeE_2017,\n    d_income_12_22 = median_incomeE_2022 - median_incomeE_2012\n  )\n\ncompare_table <- compare_sf |>\n  st_drop_geometry() |>\n  select(\n    GEOID, tract_name,\n    total_popE_2012, total_popE_2017, total_popE_2022, pop_change_12_22, pop_pct_change_12_22,\n    pct_child_2012,  pct_child_2017,  pct_child_2022,  d_pct_child_12_22,\n    pct_elderly_2012,pct_elderly_2017,pct_elderly_2022,d_pct_elderly_12_22,\n    pct_poverty_2012,pct_poverty_2017,pct_poverty_2022,d_pct_poverty_12_22,\n    pct_white_2012,  pct_white_2017,  pct_white_2022,  d_pct_white_12_22,\n    pct_black_2012,  pct_black_2017,  pct_black_2022,  d_pct_black_12_22,\n    pct_hispanic_2012,pct_hispanic_2017,pct_hispanic_2022,d_pct_hispanic_12_22,\n    median_incomeE_2012, median_incomeE_2017, median_incomeE_2022, d_income_12_17, d_income_17_22,\n  )\nkable(compare_table, digits = 2, caption = \"Sharswood tracts: ACS 2008â12 vs 2013â17 vs 2018â22\")\n```\n\n::: {.cell-output-display}\n\n\nTable: Sharswood tracts: ACS 2008â12 vs 2013â17 vs 2018â22\n\n|GEOID       |tract_name | total_popE_2012| total_popE_2017| total_popE_2022| pop_change_12_22| pop_pct_change_12_22| pct_child_2012| pct_child_2017| pct_child_2022| d_pct_child_12_22| pct_elderly_2012| pct_elderly_2017| pct_elderly_2022| d_pct_elderly_12_22| pct_poverty_2012| pct_poverty_2017| pct_poverty_2022| d_pct_poverty_12_22| pct_white_2012| pct_white_2017| pct_white_2022| d_pct_white_12_22| pct_black_2012| pct_black_2017| pct_black_2022| d_pct_black_12_22| pct_hispanic_2012| pct_hispanic_2017| pct_hispanic_2022| d_pct_hispanic_12_22| median_incomeE_2012| median_incomeE_2017| median_incomeE_2022| d_income_12_17| d_income_17_22|\n|:-----------|:----------|---------------:|---------------:|---------------:|----------------:|--------------------:|--------------:|--------------:|--------------:|-----------------:|----------------:|----------------:|----------------:|-------------------:|----------------:|----------------:|----------------:|-------------------:|--------------:|--------------:|--------------:|-----------------:|--------------:|--------------:|--------------:|-----------------:|-----------------:|-----------------:|-----------------:|--------------------:|-------------------:|-------------------:|-------------------:|--------------:|--------------:|\n|42101013800 |138        |            2026|            1840|            2077|               51|                 2.52|          23.79|          19.62|          12.28|            -11.51|            11.99|            11.47|             6.07|               -5.92|           100.00|            98.37|           100.00|                0.00|           8.49|          14.67|          25.32|             16.83|          82.63|          74.78|          59.46|            -23.17|              3.11|              5.38|              5.83|                 2.72|               26500|               27065|               68864|            565|          41799|\n|42101013900 |139        |            3323|            2603|            2585|             -738|               -22.21|          24.92|          16.71|          16.29|             -8.63|            12.61|            17.25|            15.13|                2.52|            87.93|            82.56|            85.18|               -2.75|           8.28|          20.36|          25.96|             17.68|          85.43|          68.42|          51.61|            -33.82|              3.37|              8.34|             21.08|                17.71|               15542|               15028|               41042|           -514|          26014|\n\n\n:::\n:::\n\n\n### Step 2: Facet Maps by Period\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlong_panel <- compare_sf |>\n  pivot_longer(\n    cols = matches(\"_(2012|2017|2022)$\"),\n    names_to = c(\"metric\",\"period\"),\n    names_pattern = \"(.+)_([0-9]{4})$\",\n    values_to = \"value\"\n  )\n\n# helper to draw a 3-panel small multiple for a metric\nfacet_metric <- function(metric_name, title, fill_lab, lab_fmt = NULL) {\n  p <- long_panel %>%\n    filter(metric == metric_name) %>%\n    ggplot() +\n    geom_sf(aes(fill = value), color = \"grey25\", linewidth = 0.25) +\n    facet_wrap(~ period, nrow = 1) +\n    labs(title = title, subtitle = \"Panels: 2012, 2017, 2022\",\n         fill = fill_lab, caption = \"ACS 5-year estimates\") +\n    theme_void() + theme(legend.position = \"right\")\n  if (is.null(lab_fmt)) {\n    p + scale_fill_viridis_c()\n  } else {\n    p + scale_fill_viridis_c(labels = lab_fmt)\n  }\n}\n\n# draw small multiples for your new variables\nfacet_metric(\"pct_poverty\",   \"Sharswood: % in Poverty\",           \"%\")\n```\n\n::: {.cell-output-display}\n![](demographic_change_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n\n```{.r .cell-code}\nfacet_metric(\"pct_white\",     \"Sharswood: % White (race alone)\",   \"%\")\n```\n\n::: {.cell-output-display}\n![](demographic_change_files/figure-html/unnamed-chunk-15-2.png){width=672}\n:::\n\n```{.r .cell-code}\nfacet_metric(\"pct_black\",     \"Sharswood: % Black (race alone)\",   \"%\")\n```\n\n::: {.cell-output-display}\n![](demographic_change_files/figure-html/unnamed-chunk-15-3.png){width=672}\n:::\n\n```{.r .cell-code}\nfacet_metric(\"pct_hispanic\",  \"Sharswood: % Hispanic (any race)\",  \"%\")\n```\n\n::: {.cell-output-display}\n![](demographic_change_files/figure-html/unnamed-chunk-15-4.png){width=672}\n:::\n\n```{.r .cell-code}\nfacet_metric(\"pct_child\",     \"Sharswood: % Children (5â19)\",      \"%\")\n```\n\n::: {.cell-output-display}\n![](demographic_change_files/figure-html/unnamed-chunk-15-5.png){width=672}\n:::\n\n```{.r .cell-code}\nfacet_metric(\"pct_elderly\",   \"Sharswood: % Elderly (65+)\",        \"%\")\n```\n\n::: {.cell-output-display}\n![](demographic_change_files/figure-html/unnamed-chunk-15-6.png){width=672}\n:::\n\n```{.r .cell-code}\nfacet_metric(\"median_incomeE\",\"Sharswood: Median Household Income\",\"$\", dollar_format())\n```\n\n::: {.cell-output-display}\n![](demographic_change_files/figure-html/unnamed-chunk-15-7.png){width=672}\n:::\n:::\n\n\n### Step 3: Change Maps\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# helper to make a diverging change map\nchange_map <- function(col, title, legend) {\n  ggplot(compare_sf) +\n    geom_sf(aes(fill = .data[[col]]), color = \"grey25\", linewidth = 0.25) +\n    scale_fill_gradient2(midpoint = 0, name = legend) +\n    labs(title = title) +\n    theme_void()\n}\n\nchange_map(\"d_pct_poverty_12_22\",  \"Change in % Poverty (2012â2022)\",  \"Î pct-pts\")\n```\n\n::: {.cell-output-display}\n![](demographic_change_files/figure-html/unnamed-chunk-16-1.png){width=672}\n:::\n\n```{.r .cell-code}\nchange_map(\"d_pct_child_12_22\",    \"Change in % Children (2012â2022)\", \"Î pct-pts\")\n```\n\n::: {.cell-output-display}\n![](demographic_change_files/figure-html/unnamed-chunk-16-2.png){width=672}\n:::\n\n```{.r .cell-code}\nchange_map(\"d_pct_elderly_12_22\",  \"Change in % Elderly (2012â2022)\",  \"Î pct-pts\")\n```\n\n::: {.cell-output-display}\n![](demographic_change_files/figure-html/unnamed-chunk-16-3.png){width=672}\n:::\n\n```{.r .cell-code}\nchange_map(\"d_pct_white_12_22\",    \"Change in % White (2012â2022)\",    \"Î pct-pts\")\n```\n\n::: {.cell-output-display}\n![](demographic_change_files/figure-html/unnamed-chunk-16-4.png){width=672}\n:::\n\n```{.r .cell-code}\nchange_map(\"d_pct_black_12_22\",    \"Change in % Black (2012â2022)\",    \"Î pct-pts\")\n```\n\n::: {.cell-output-display}\n![](demographic_change_files/figure-html/unnamed-chunk-16-5.png){width=672}\n:::\n\n```{.r .cell-code}\nchange_map(\"d_pct_hispanic_12_22\", \"Change in % Hispanic (2012â2022)\", \"Î pct-pts\")\n```\n\n::: {.cell-output-display}\n![](demographic_change_files/figure-html/unnamed-chunk-16-6.png){width=672}\n:::\n\n```{.r .cell-code}\nchange_map(\"pop_pct_change_12_22\", \"Population % Change (2012â2022)\",  \"% change\")\n```\n\n::: {.cell-output-display}\n![](demographic_change_files/figure-html/unnamed-chunk-16-7.png){width=672}\n:::\n\n```{.r .cell-code}\nchange_map(\"d_income_12_22\",       \"Change in Median Income (2012â2022) â period $\", \"$ change\")\n```\n\n::: {.cell-output-display}\n![](demographic_change_files/figure-html/unnamed-chunk-16-8.png){width=672}\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbars <- long_panel |>\n  filter(metric %in% c(\"pct_child\",\"pct_elderly\")) |>\n  mutate(metric = recode(metric, pct_child = \"% Children (5â19)\", pct_elderly = \"% Elderly (65+)\"))\n\nggplot(bars, aes(x = period, y = value, fill = period)) +\n  geom_col(width = 0.7) +\n  facet_grid(metric ~ tract_name, scales = \"free_y\") +\n  scale_y_continuous(labels = label_number(accuracy = 0.1)) +\n  labs(title = \"BeforeâAfter Comparison by Tract and Period\",\n       x = NULL, y = \"Percent\") +\n  theme_minimal() + theme(legend.position = \"none\")\n```\n\n::: {.cell-output-display}\n![](demographic_change_files/figure-html/unnamed-chunk-17-1.png){width=672}\n:::\n:::\n\n\n### Step 4: Composite Maps\n\n**Multi-metric Ã Period Grid**\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngrid_metrics <- c(\"pct_poverty\",\"pct_child\",\"pct_elderly\",\"pct_black\",\"pct_white\",\"pct_hispanic\")\nlong_subset <- long_panel %>% filter(metric %in% grid_metrics)\n\nggplot(long_subset) +\n  geom_sf(aes(fill = value), color = \"grey25\", linewidth = 0.25) +\n  facet_grid(metric ~ period) +\n  scale_fill_viridis_c() +\n  labs(title = \"Sharswood: Key Demographic Rates by Period and Metric\",\n       caption = \"ACS 5-year estimates\") +\n  theme_void() + theme(legend.position = \"right\")\n```\n\n::: {.cell-output-display}\n![](demographic_change_files/figure-html/unnamed-chunk-18-1.png){width=672}\n:::\n:::\n\n\n**Bivariate change map**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(forcats)\n\nbivar <- compare_sf %>%\n  st_drop_geometry() %>%\n  transmute(GEOID,\n            d_pov = d_pct_poverty_12_22,\n            d_inc = d_income_12_22) %>%\n  mutate(\n    c_pov = cut_number(d_pov, n = 3, labels = c(\"low Îpov\",\"mid Îpov\",\"high Îpov\")),\n    c_inc = cut_number(d_inc, n = 3, labels = c(\"low Îinc\",\"mid Îinc\",\"high Îinc\")),\n    bivar_class = interaction(fct_rev(c_pov), c_inc, sep = \" / \", drop = TRUE)\n  )\n\n# simple 3x3 palette\npal <- c(\n  \"high Îpov / low Îinc\"  = \"#3F2949\",\"high Îpov / mid Îinc\" = \"#435786\",\"high Îpov / high Îinc\" = \"#4885C1\",\n  \"mid Îpov / low Îinc\"   = \"#77324C\",\"mid Îpov / mid Îinc\"  = \"#806A8A\",\"mid Îpov / high Îinc\"  = \"#89A1C8\",\n  \"low Îpov / low Îinc\"   = \"#AE3A4E\",\"low Îpov / mid Îinc\"  = \"#BC7C8F\",\"low Îpov / high Îinc\"  = \"#CABED0\"\n)\n\ncompare_bivar <- compare_sf %>% left_join(bivar, by = \"GEOID\")\n\nggplot(compare_bivar) +\n  geom_sf(aes(fill = bivar_class), color = \"grey25\", linewidth = 0.25) +\n  scale_fill_manual(values = pal, na.value = \"grey85\", name = \"Î Poverty vs Î Income\\n(2012â2022)\") +\n  labs(title = \"Bivariate Change Map: Poverty (pct-pts) vs Income ($)\") +\n  theme_void()\n```\n\n::: {.cell-output-display}\n![](demographic_change_files/figure-html/unnamed-chunk-19-1.png){width=672}\n:::\n:::\n\n",
    "supporting": [
      "demographic_change_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}