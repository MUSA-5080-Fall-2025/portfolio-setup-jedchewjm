{
  "hash": "85cf745a8b5ec949c9bcbcfc3b1b5dbb",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Demographic Changes at Census Tract Level - Sharswood\"\nsubtitle: \"URBS 4000: Urban Studies Thesis\"\nauthor: \"Jed Chew\"\ndate: today\nformat: \n  html:\n    code-fold: false\n    toc: true\n    toc-location: left\n    theme: cosmo\n    embed-resources: true\nexecute:\n  warning: false\n  message: false\neditor: \n  markdown: \n    wrap: 80\n---\n\n## Project Title: Mixed by Design\n\n### *A Case Study of the Philadelphia Housing Authority's (PHA) Choice Neighborhoods Redevelopment of Sharswood*\n\nFor my Urban Studies thesis, I am researching the PHA's Choice Neighborhoods\nredevelopment of the Sharswood neighborhood in North Philadelphia. I have two\nmain research questions about the process and outcome of this redevelopment:\n\n\\(1\\) the **process** by which the PHA aligned the politics, finance, and design\nfor the redevelopment of Sharswood; andÂ \n\n\\(2\\) the early redevelopment **outcomes** relative to the Choice Neighborhoods\nInitiative (CNI) vision of mixed-partners, mixed-use, and mixed-income\n\n## Part 1: ACS Data\n\n**American Community Survey (ACS) Estimates**\n\n\\<insert information from\n\n### Step 1: Load Raw Data as csv files\n\n-   Philadelphia census tracts, block groups, and neighborhood boundaries\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load spatial data\ncensus_tracts <- tracts(state = \"PA\", county = \"Philadelphia\", year = 2020, class = \"sf\", cb = TRUE, progress = FALSE)\nblock_grps <- block_groups(state = \"PA\", county = \"Philadelphia\", year = 2020, class = \"sf\",cb = TRUE, progress = FALSE)\n\n# Standardize CRS\n```\n:::\n\n\n--------------------------------------------------------------------------------\n\n### Step 2: Get Philadelphia Demographic Data using `tidycensus`\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load all available variables for ACS 5-year 2022\nacs_vars_2022 <- load_variables(2022, \"acs5\", cache = TRUE)\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Helper Variables for Summing Population Values for Children aged 5-19\nchild_pop = c(\"B01001_004\", \"B01001_005\", \"B01001_006\", \"B01001_007\", \n                \"B01001_028\", \"B01001_029\", \"B01001_030\", \"B01001_031\")\n\n\n# Helper Variable for Summing Population Values for Elderly Population\nelderly_pop = c(\"B01001_020\", \"B01001_021\", \"B01001_022\", \"B01001_023\", \n                \"B01001_024\", \"B01001_025\", \n                \"B01001_044\", \"B01001_045\", \"B01001_046\", \n                \"B01001_047\", \"B01001_048\", \"B01001_049\")\n\n# Get tract-level demographic data from 2022 ACS 5-Yr Estimates for Philadelphia\nphl_tract_2022_data <- get_acs(\n  geography = \"tract\",\n  variables = c(\n    total_pop = \"B01003_001\",\n    child_pop = child_pop,\n    elderly_pop = elderly_pop,\n    median_income = \"B19013_001\",\n    poverty = \"B17001_001\",\n    White     = \"B03002_003\",\n    Black     = \"B03002_004\",\n    Hispanic  = \"B03002_012\"\n  ),\n  state = \"PA\",\n  county = \"Philadelphia\",\n  year = 2022,\n  survey = \"acs5\",\n  output = \"wide\",\n  geometry = TRUE\n)\n\n# Clean the county names to remove state name and \"County\" \nphl_tract_2022_clean <- phl_tract_2022_data |> \n  separate(\n    NAME, \n    into = c(\"tract_name\", \"county_name\", \"state_name\"), \n    sep = \"; \"\n  ) |> \n  mutate(\n    tract_name = str_remove(tract_name, \"Census Tract \"),\n    county_name = str_remove(county_name, \" County\")\n  )\n\nphl_tract_2022_summary <- phl_tract_2022_clean |>\n  mutate(\n    elderly_popE = rowSums(across(matches(\"^elderly_pop\\\\d+E$\")), na.rm = TRUE),\n    # for MOE, ACS guidance is to combine by quadrature\n    elderly_popM = sqrt(rowSums(across(matches(\"^elderly_pop\\\\d+M$\"))^2, na.rm = \n                                  TRUE)),\n    pct_elderly = round((elderly_popE / total_popE) *100, 2),\n    child_popE = rowSums(across(matches(\"^child_pop\\\\d+E$\")), na.rm = TRUE),\n    child_popM = sqrt(rowSums(across(matches(\"^child_pop\\\\d+M$\"))^2, na.rm = \n                                  TRUE)),\n    pct_child = round((child_popE/total_popE) * 100, 2),\n  ) |>\n  select(GEOID, tract_name, county_name, total_popE, median_incomeE, elderly_popE, \n         elderly_popM, pct_elderly, child_popE, child_popM, pct_child)\n```\n:::\n\n\n--------------------------------------------------------------------------------\n\n### Step 3: Filter Data for Sharswood\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Filter Census Tracts for Sharswood\nsharswood_2022_tract_sf <- phl_tract_2022_summary |> \n  filter(tract_name %in% c(\"138\", \"139\"))\n\nggplot(sharswood_2022_tract_sf) +\n  geom_sf() +\n  theme_void()\n```\n\n::: {.cell-output-display}\n![](demographic_change_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n\n```{.r .cell-code}\nsharswood_2022_tract <- sharswood_2022_tract_sf |> \n  st_drop_geometry()\nsharswood_2022_tract\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n        GEOID tract_name  county_name total_popE median_incomeE elderly_popE\n1 42101013800        138 Philadelphia       2077          68864          126\n2 42101013900        139 Philadelphia       2585          41042          391\n  elderly_popM pct_elderly child_popE child_popM pct_child\n1     78.56208        6.07        255   127.1102     12.28\n2    142.44999       15.13        421   255.5876     16.29\n```\n\n\n:::\n:::\n\n\n--------------------------------------------------------------------------------\n\n### Step 4: Repeat Process for 2013-2017 ACS 5-Yr Estimates\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Helper Variables for Summing Population Values for Children aged 5-19\nchild_pop = c(\"B01001_004\", \"B01001_005\", \"B01001_006\", \"B01001_007\", \n                \"B01001_028\", \"B01001_029\", \"B01001_030\", \"B01001_031\")\n\n\n# Helper Variable for Summing Population Values for Elderly Population\nelderly_pop = c(\"B01001_020\", \"B01001_021\", \"B01001_022\", \"B01001_023\", \n                \"B01001_024\", \"B01001_025\", \n                \"B01001_044\", \"B01001_045\", \"B01001_046\", \n                \"B01001_047\", \"B01001_048\", \"B01001_049\")\n\n# Get tract-level demographic data from 2022 ACS 5-Yr Estimates for Philadelphia\nphl_2017_tract_data <- get_acs(\n  geography = \"tract\",\n  variables = c(\n    total_pop = \"B01003_001\",\n    child_pop = child_pop,\n    elderly_pop = elderly_pop,\n    median_income = \"B19013_001\",\n    poverty = \"B17001_001\",\n    White     = \"B03002_003\",\n    Black     = \"B03002_004\",\n    Hispanic  = \"B03002_012\"\n  ),\n  state = \"PA\",\n  county = \"Philadelphia\",\n  year = 2017,\n  survey = \"acs5\",\n  output = \"wide\",\n  geometry = TRUE\n)\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Clean the county names to remove state name and \"County\" \nphl_2017_tract_clean <- phl_2017_tract_data |> \n  separate(\n    NAME, \n    into = c(\"tract_name\", \"county_name\", \"state_name\"), \n    sep = \", \"\n  ) |> \n  mutate(\n    tract_name = str_remove(tract_name, \"Census Tract \"),\n    county_name = str_remove(county_name, \" County\")\n  )\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nphl_2017_tract_summary <- phl_2017_tract_clean |>\n  mutate(\n    elderly_popE = rowSums(across(matches(\"^elderly_pop\\\\d+E$\")), na.rm = TRUE),\n    # for MOE, ACS guidance is to combine by quadrature\n    elderly_popM = sqrt(rowSums(across(matches(\"^elderly_pop\\\\d+M$\"))^2, na.rm = \n                                  TRUE)),\n    pct_elderly = round((elderly_popE / total_popE) *100, 2),\n    child_popE = rowSums(across(matches(\"^child_pop\\\\d+E$\")), na.rm = TRUE),\n    child_popM = sqrt(rowSums(across(matches(\"^child_pop\\\\d+M$\"))^2, na.rm = \n                                  TRUE)),\n    pct_child = round((child_popE/total_popE) * 100, 2),\n  ) |>\n  select(GEOID, tract_name, county_name, total_popE, median_incomeE, elderly_popE,\n         elderly_popM, pct_elderly, child_popE, child_popM, pct_child)\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Filter Census Tracts for Sharswood\nsharswood_2017_tract_sf <- phl_2017_tract_summary |> \n  filter(tract_name == c(\"138\", \"139\"))\n\nggplot(sharswood_2017_tract_sf) +\n  geom_sf() +\n  theme_void()\n```\n\n::: {.cell-output-display}\n![](demographic_change_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n\n```{.r .cell-code}\nsharswood_2017_tract <- sharswood_2017_tract_sf |> \n  st_drop_geometry()\nsharswood_2017_tract\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n        GEOID tract_name  county_name total_popE median_incomeE elderly_popE\n1 42101013900        139 Philadelphia       2603          15028          449\n2 42101013800        138 Philadelphia       1840          27065          211\n  elderly_popM pct_elderly child_popE child_popM pct_child\n1    113.36225       17.25        435   179.5661     16.71\n2     61.48984       11.47        361   107.6336     19.62\n```\n\n\n:::\n:::\n\n\n### Step 5: Repeat Process for 2008-2012 ACS 5-Yr Estimates\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Helper Variables for Summing Population Values for Children aged 5-19\nchild_pop = c(\"B01001_004\", \"B01001_005\", \"B01001_006\", \"B01001_007\", \n                \"B01001_028\", \"B01001_029\", \"B01001_030\", \"B01001_031\")\n\n\n# Helper Variable for Summing Population Values for Elderly Population\nelderly_pop = c(\"B01001_020\", \"B01001_021\", \"B01001_022\", \"B01001_023\", \n                \"B01001_024\", \"B01001_025\", \n                \"B01001_044\", \"B01001_045\", \"B01001_046\", \n                \"B01001_047\", \"B01001_048\", \"B01001_049\")\n\n# Get tract-level demographic data from 2022 ACS 5-Yr Estimates for Philadelphia\nphl_2012_tract_data <- get_acs(\n  geography = \"tract\",\n  variables = c(\n    total_pop = \"B01003_001\",\n    child_pop = child_pop,\n    elderly_pop = elderly_pop,\n    median_income = \"B19013_001\",\n    poverty = \"B17001_001\",\n    White     = \"B03002_003\",\n    Black     = \"B03002_004\",\n    Hispanic  = \"B03002_012\"\n  ),\n  state = \"PA\",\n  county = \"Philadelphia\",\n  year = 2012,\n  survey = \"acs5\",\n  output = \"wide\",\n  geometry = TRUE\n)\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Clean the county names to remove state name and \"County\" \nphl_2012_tract_clean <- phl_2012_tract_data |> \n  separate(\n    NAME, \n    into = c(\"tract_name\", \"county_name\", \"state_name\"), \n    sep = \", \"\n  ) |> \n  mutate(\n    tract_name = str_remove(tract_name, \"Census Tract \"),\n    county_name = str_remove(county_name, \" County\")\n  )\n\nphl_2012_tract_summary <- phl_2012_tract_clean |>\n  mutate(\n    elderly_popE = rowSums(across(matches(\"^elderly_pop\\\\d+E$\")), na.rm = TRUE),\n    # for MOE, ACS guidance is to combine by quadrature\n    elderly_popM = sqrt(rowSums(across(matches(\"^elderly_pop\\\\d+M$\"))^2, na.rm = \n                                  TRUE)),\n    pct_elderly = round((elderly_popE / total_popE) *100, 2),\n    child_popE = rowSums(across(matches(\"^child_pop\\\\d+E$\")), na.rm = TRUE),\n    child_popM = sqrt(rowSums(across(matches(\"^child_pop\\\\d+M$\"))^2, na.rm = \n                                  TRUE)),\n    pct_child = round((child_popE/total_popE) * 100, 2),\n  ) |>\n  select(GEOID, tract_name, county_name, total_popE, median_incomeE, elderly_popE,\n         elderly_popM, pct_elderly, child_popE, child_popM, pct_child)\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Filter Census Tracts for Sharswood\nsharswood_2012_tract_sf <- phl_2012_tract_summary |> \n  filter(tract_name %in% c(\"138\", \"139\"))\n\nggplot(sharswood_2012_tract_sf) +\n  geom_sf() +\n  theme_void()\n```\n\n::: {.cell-output-display}\n![](demographic_change_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n\n```{.r .cell-code}\nsharswood_2012_tract <- sharswood_2012_tract_sf |> \n  st_drop_geometry()\nsharswood_2012_tract\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n        GEOID tract_name  county_name total_popE median_incomeE elderly_popE\n1 42101013800        138 Philadelphia       2026          26500          243\n2 42101013900        139 Philadelphia       3323          15542          419\n  elderly_popM pct_elderly child_popE child_popM pct_child\n1     98.40732       11.99        482   206.3032     23.79\n2    147.05441       12.61        828   213.2815     24.92\n```\n\n\n:::\n:::\n\n\n--------------------------------------------------------------------------------\n\n## Part 2: Comprehensive Visualization and Analysis\n\n--------------------------------------------------------------------------------\n\n### Step 1: Rename Columns for ACS Year\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncols_to_suffix <- c(\n  \"total_popE\",\"median_incomeE\",\n  \"elderly_popE\",\"elderly_popM\",\"pct_elderly\",\n  \"child_popE\",\"child_popM\",\"pct_child\"\n)\n\ns12_sf <- sharswood_2012_tract_sf |>\n  rename_with(~ paste0(.x, \"_2012\"), any_of(cols_to_suffix))\ns12 <- sharswood_2012_tract |>\n  rename_with(~ paste0(.x, \"_2012\"), any_of(cols_to_suffix))\ns17_sf <- sharswood_2017_tract_sf |>\n  rename_with(~ paste0(.x, \"_2017\"), any_of(cols_to_suffix))\ns17 <- sharswood_2017_tract |>\n  rename_with(~ paste0(.x, \"_2017\"), any_of(cols_to_suffix))\ns22_sf <- sharswood_2022_tract_sf |>\n  rename_with(~ paste0(.x, \"_2022\"), any_of(cols_to_suffix))\ns22 <- sharswood_2022_tract |>\n  rename_with(~ paste0(.x, \"_2022\"), any_of(cols_to_suffix))\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncompare_sf <- s12_sf |>\n  select(GEOID, tract_name, county_name, geometry, ends_with(\"_2012\")) |>\n  left_join(select(s17, GEOID, ends_with(\"_2017\")), by = \"GEOID\") |>\n  left_join(select(s22, GEOID, ends_with(\"_2022\")), by = \"GEOID\") |>\n  mutate(\n    pop_change_12_22       = total_popE_2022 - total_popE_2012,\n    pop_pct_change_12_22   = 100 * (total_popE_2022 - total_popE_2012) / pmax(1, total_popE_2012),\n\n    child_pct_change_12_22   = pct_child_2022   - pct_child_2012,\n    elderly_pct_change_12_22 = pct_elderly_2022 - pct_elderly_2012,\n\n    income_change_12_22 = median_incomeE_2022 - median_incomeE_2012,\n    income_change_12_17 = median_incomeE_2017 - median_incomeE_2012,\n    income_change_17_22 = median_incomeE_2022 - median_incomeE_2017\n  )\n\ncompare_table <- compare_sf |>\n  st_drop_geometry() |>\n  select(\n    GEOID, tract_name,\n    total_popE_2012, total_popE_2017, total_popE_2022, pop_change_12_22, pop_pct_change_12_22,\n    pct_child_2012, pct_child_2017, pct_child_2022, child_pct_change_12_22,\n    pct_elderly_2012, pct_elderly_2017, pct_elderly_2022, elderly_pct_change_12_22,\n    median_incomeE_2012, median_incomeE_2017, median_incomeE_2022,\n    income_change_12_17, income_change_17_22, income_change_12_22\n  )\nkable(compare_table, digits = 2, caption = \"Sharswood tracts: ACS 2008â12 vs 2013â17 vs 2018â22\")\n```\n\n::: {.cell-output-display}\n\n\nTable: Sharswood tracts: ACS 2008â12 vs 2013â17 vs 2018â22\n\n|GEOID       |tract_name | total_popE_2012| total_popE_2017| total_popE_2022| pop_change_12_22| pop_pct_change_12_22| pct_child_2012| pct_child_2017| pct_child_2022| child_pct_change_12_22| pct_elderly_2012| pct_elderly_2017| pct_elderly_2022| elderly_pct_change_12_22| median_incomeE_2012| median_incomeE_2017| median_incomeE_2022| income_change_12_17| income_change_17_22| income_change_12_22|\n|:-----------|:----------|---------------:|---------------:|---------------:|----------------:|--------------------:|--------------:|--------------:|--------------:|----------------------:|----------------:|----------------:|----------------:|------------------------:|-------------------:|-------------------:|-------------------:|-------------------:|-------------------:|-------------------:|\n|42101013800 |138        |            2026|            1840|            2077|               51|                 2.52|          23.79|          19.62|          12.28|                 -11.51|            11.99|            11.47|             6.07|                    -5.92|               26500|               27065|               68864|                 565|               41799|               42364|\n|42101013900 |139        |            3323|            2603|            2585|             -738|               -22.21|          24.92|          16.71|          16.29|                  -8.63|            12.61|            17.25|            15.13|                     2.52|               15542|               15028|               41042|                -514|               26014|               25500|\n\n\n:::\n:::\n\n\n### Step 2: Facet Maps by Period\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlong_panel <- compare_sf |>\n  pivot_longer(\n    cols = matches(\"_(2012|2017|2022)$\"),\n    names_to = c(\"metric\",\"period\"),\n    names_pattern = \"(.+)_([0-9]{4})$\",\n    values_to = \"value\"\n  )\n\n# (A) % Children\nggplot(filter(long_panel, metric == \"pct_child\")) +\n  geom_sf(aes(fill = value), color = \"grey25\", linewidth = 0.25) +\n  facet_wrap(~ period, nrow = 1) +\n  scale_fill_viridis_c(name = \"% age 5â19\") +\n  labs(title = \"Sharswood: % Children by ACS period\",\n       subtitle = \"2008â12 (2012), 2013â17 (2017), 2018â22 (2022)\",\n       caption = \"ACS 5-year estimates\") +\n  theme_void() + theme(legend.position = \"right\")\n```\n\n::: {.cell-output-display}\n![](demographic_change_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# (B) % Elderly\nggplot(filter(long_panel, metric == \"pct_elderly\")) +\n  geom_sf(aes(fill = value), color = \"grey25\", linewidth = 0.25) +\n  facet_wrap(~ period, nrow = 1) +\n  scale_fill_viridis_c(name = \"% age 65+\") +\n  labs(title = \"Sharswood: % Elderly by ACS period\") +\n  theme_void()\n```\n\n::: {.cell-output-display}\n![](demographic_change_files/figure-html/unnamed-chunk-15-2.png){width=672}\n:::\n\n```{.r .cell-code}\n# (C) Median income (note comparability caveat)\nggplot(filter(long_panel, metric == \"median_incomeE\")) +\n  geom_sf(aes(fill = value), color = \"grey25\", linewidth = 0.25) +\n  facet_wrap(~ period, nrow = 1) +\n  scale_fill_viridis_c(name = \"Median HH income\",\n                       labels = dollar_format(accuracy = 1)) +\n  labs(title = \"Sharswood: Median Household Income\",\n       subtitle = \"Each periodâs dollars (not adjusted to a common base year)\") +\n  theme_void()\n```\n\n::: {.cell-output-display}\n![](demographic_change_files/figure-html/unnamed-chunk-15-3.png){width=672}\n:::\n:::\n\n\n### Step 3: Change Maps\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Î % Children\nggplot(compare_sf) +\n  geom_sf(aes(fill = child_pct_change_12_22), color = \"grey25\", linewidth = 0.25) +\n  scale_fill_gradient2(name = \"Î % children\\n(2022 â 2012)\", midpoint = 0) +\n  labs(title = \"Change in % Children, 2008â12 â 2018â22\") +\n  theme_void()\n```\n\n::: {.cell-output-display}\n![](demographic_change_files/figure-html/unnamed-chunk-16-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# Î % Elderly\nggplot(compare_sf) +\n  geom_sf(aes(fill = elderly_pct_change_12_22), color = \"grey25\", linewidth = 0.25) +\n  scale_fill_gradient2(name = \"Î % elderly\\n(2022 â 2012)\", midpoint = 0) +\n  labs(title = \"Change in % Elderly, 2008â12 â 2018â22\") +\n  theme_void()\n```\n\n::: {.cell-output-display}\n![](demographic_change_files/figure-html/unnamed-chunk-16-2.png){width=672}\n:::\n\n```{.r .cell-code}\n# Population % change\nggplot(compare_sf) +\n  geom_sf(aes(fill = pop_pct_change_12_22), color = \"grey25\", linewidth = 0.25) +\n  scale_fill_gradient2(name = \"Population % change\\n(2022 â 2012)\", midpoint = 0,\n                       labels = label_percent(scale = 1, accuracy = 1)) +\n  labs(title = \"Population % Change, 2008â12 â 2018â22\") +\n  theme_void()\n```\n\n::: {.cell-output-display}\n![](demographic_change_files/figure-html/unnamed-chunk-16-3.png){width=672}\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbars <- long_panel |>\n  filter(metric %in% c(\"pct_child\",\"pct_elderly\")) |>\n  mutate(metric = recode(metric, pct_child = \"% Children (5â19)\", pct_elderly = \"% Elderly (65+)\"))\n\nggplot(bars, aes(x = period, y = value, fill = period)) +\n  geom_col(width = 0.7) +\n  facet_grid(metric ~ tract_name, scales = \"free_y\") +\n  scale_y_continuous(labels = label_number(accuracy = 0.1)) +\n  labs(title = \"BeforeâAfter Comparison by Tract and Period\",\n       x = NULL, y = \"Percent\") +\n  theme_minimal() + theme(legend.position = \"none\")\n```\n\n::: {.cell-output-display}\n![](demographic_change_files/figure-html/unnamed-chunk-17-1.png){width=672}\n:::\n:::\n\n",
    "supporting": [
      "demographic_change_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}