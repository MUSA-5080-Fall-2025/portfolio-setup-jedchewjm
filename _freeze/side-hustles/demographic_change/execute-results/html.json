{
  "hash": "e39aa90636fc0d54fe9fa0637d16a6d8",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Demographic Changes at Census Tract Level - Sharswood\"\nsubtitle: \"URBS 4000: Urban Studies Thesis\"\nauthor: \"Jed Chew\"\ndate: today\nformat: \n  html:\n    code-fold: false\n    toc: true\n    toc-location: left\n    theme: cosmo\n    embed-resources: true\nexecute:\n  warning: false\n  message: false\neditor: \n  markdown: \n    wrap: 80\n---\n\n## Project Title: Mixed by Design\n\n### *A Case Study of the Philadelphia Housing Authority's (PHA) Choice Neighborhoods Redevelopment of Sharswood*\n\nFor my Urban Studies thesis, I am researching the PHA's Choice Neighborhoods\nredevelopment of the Sharswood neighborhood in North Philadelphia. I have two\nmain research questions about the process and outcome of this redevelopment:\n\n\\(1\\) the **process** by which the PHA aligned the politics, finance, and design\nfor the redevelopment of Sharswood; and \n\n\\(2\\) the early redevelopment **outcomes** relative to the Choice Neighborhoods\nInitiative (CNI) vision of mixed-partners, mixed-use, and mixed-income\n\n## Part 1: ACS Data\n\n**American Community Survey (ACS) Estimates**\n\nThe first ACS 5-year estimate was released in late 2010 as a replacement of the\nlongform decennial Census. Every year, the ACS surveys about 1 in 40 housing\nunits to produce 1-year estimates, but these housing units must not have been\nsurveyed in the previous five years. Hence, the 5-year estimate incorporates\nfive years of non-overlapping data (approximately 1 in 8 housing units) to\nrecreate the longform of the decennial census.\n\nIn this exploratory data analysis, I used three separate (i.e. no overlapping\nyears) ACS 5-year estimates to provide pre- and post-redevelopment snapshots:\n2009-2012, 2013-17, and 2018-2022.\n\nThere are two main limitations with this methodology:\n\n1.  The census tracts do not align exactly with the boundaries of the Sharswood\n    redevelopment area\n2.  5-year estimates also smooth out significant redevelopment events over\n    multiple years, and it is challenging to identify the critical junctures in\n    the redevelopment process and their direct impact on the neighborhood\n\n### Step 1: Load Philadelphia Demographic Data using `tidycensus`\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load required packages\nlibrary(tidyverse)\nlibrary(tidycensus)\nlibrary(janitor)\nlibrary(sf)\nlibrary(tigris)\nlibrary(scales)\nlibrary(patchwork)\nlibrary(RColorBrewer)\nlibrary(units)\nlibrary(knitr)\nlibrary(caret)\n```\n:::\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load all available variables for ACS 5-year 2022\nacs_vars_2022 <- load_variables(2022, \"acs5\", cache = TRUE)\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Helper Variables for Summing Population Values for Children aged 5-19\nchild_pop = c(\"B01001_004\", \"B01001_005\", \"B01001_006\", \"B01001_007\", \n                \"B01001_028\", \"B01001_029\", \"B01001_030\", \"B01001_031\")\n\n\n# Helper Variable for Summing Population Values for Elderly Population\nelderly_pop = c(\"B01001_020\", \"B01001_021\", \"B01001_022\", \"B01001_023\", \n                \"B01001_024\", \"B01001_025\", \n                \"B01001_044\", \"B01001_045\", \"B01001_046\", \n                \"B01001_047\", \"B01001_048\", \"B01001_049\")\n\n# Helper Function for Variables\nvars <- c(\n  total_pop = \"B01003_001\",\n  child_pop = child_pop,\n  elderly_pop = elderly_pop,\n  median_income = \"B19013_001\",\n  poverty_total = \"B17001_001\",\n  poverty_level = \"B17001_002\",\n  White     = \"B03002_003\",\n  Black     = \"B03002_004\",\n  Hispanic  = \"B03002_012\"\n)\n\n# Helper Function for Summarizing ACS\nsummarize_acs <- function(df) {\n  df |> \n       mutate(\n      # totals (E) and MOEs (M; combined by quadrature)\n      elderly_popE = rowSums(across(matches(\"^elderly_pop\\\\d+E$\")), na.rm = TRUE),\n      elderly_popM = sqrt(rowSums(across(matches(\"^elderly_pop\\\\d+M$\"), ~ (.x)^2), na.rm = TRUE)),\n      child_popE   = rowSums(across(matches(\"^child_pop\\\\d+E$\")),   na.rm = TRUE),\n      child_popM   = sqrt(rowSums(across(matches(\"^child_pop\\\\d+M$\"),   ~ (.x)^2), na.rm = TRUE)),\n\n      # percentages\n      pct_elderly  = round((elderly_popE / total_popE) * 100, 2),\n      pct_child    = round((child_popE   / total_popE) * 100, 2),\n      pct_white    = round((WhiteE       / total_popE) * 100, 2),\n      pct_black    = round((BlackE       / total_popE) * 100, 2),\n      pct_hispanic = round((HispanicE    / total_popE) * 100, 2),\n      pct_poverty  = round((poverty_levelE / poverty_totalE) * 100, 2)\n    ) |>\n    select(any_of(c(\n      \"GEOID\", \"tract_name\", \"county_name\", \"total_popE\", \"median_incomeE\",\n      \"elderly_popE\", \"elderly_popM\", \"pct_elderly\",\n      \"child_popE\", \"child_popM\", \"pct_child\",\n      \"pct_poverty\", \"pct_white\", \"pct_black\", \"pct_hispanic\", \"geometry\")))\n}\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Get tract-level demographic data from 2022 ACS 5-Yr Estimates for Philadelphia\nphl_tract_2022_data <- get_acs(\n  geography = \"tract\",\n  variables = vars,\n  state = \"PA\",\n  county = \"Philadelphia\",\n  year = 2022,\n  survey = \"acs5\",\n  output = \"wide\",\n  geometry = TRUE\n)\n\n# Clean the county names to remove state name and \"County\" \nphl_tract_2022_clean <- phl_tract_2022_data |> \n  separate(\n    NAME, \n    into = c(\"tract_name\", \"county_name\", \"state_name\"), \n    sep = \"; \"\n  ) |> \n  mutate(\n    tract_name = str_remove(tract_name, \"Census Tract \"),\n    county_name = str_remove(county_name, \" County\")\n  )\nphl_tract_2022_summary <- summarize_acs(phl_tract_2022_clean)\n```\n:::\n\n\n--------------------------------------------------------------------------------\n\n### Step 2: Filter Data for Sharswood\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Filter Census Tracts for Sharswood\nsharswood_2022_tract_sf <- phl_tract_2022_summary |> \n  filter(tract_name %in% c(\"138\", \"139\"))\n\nsharswood_2022_tract <- sharswood_2022_tract_sf |> \n  st_drop_geometry()\nsharswood_2022_tract\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n        GEOID tract_name  county_name total_popE median_incomeE elderly_popE\n1 42101013800        138 Philadelphia       2077          68864          126\n2 42101013900        139 Philadelphia       2585          41042          391\n  elderly_popM pct_elderly child_popE child_popM pct_child pct_poverty\n1     78.56208        6.07        255   127.1102     12.28        9.24\n2    142.44999       15.13        421   255.5876     16.29       32.79\n  pct_white pct_black pct_hispanic\n1     25.32     59.46         5.83\n2     25.96     51.61        21.08\n```\n\n\n:::\n:::\n\n\n--------------------------------------------------------------------------------\n\n### Step 3: Repeat Process for 2013-2017 ACS 5-Yr Estimates\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Get tract-level demographic data from 2017 ACS 5-Yr Estimates for Philadelphia\nphl_2017_tract_data <- get_acs(\n  geography = \"tract\",\n  variables = vars,\n  state = \"PA\",\n  county = \"Philadelphia\",\n  year = 2017,\n  survey = \"acs5\",\n  output = \"wide\",\n  geometry = TRUE\n)\n\n# Clean the county names to remove state name and \"County\" \nphl_2017_tract_clean <- phl_2017_tract_data |> \n  separate(\n    NAME, \n    into = c(\"tract_name\", \"county_name\", \"state_name\"), \n    sep = \", \"\n  ) |> \n  mutate(\n    tract_name = str_remove(tract_name, \"Census Tract \"),\n    county_name = str_remove(county_name, \" County\")\n  )\nphl_2017_tract_summary <- summarize_acs(phl_2017_tract_clean)\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Filter Census Tracts for Sharswood\nsharswood_2017_tract_sf <- phl_2017_tract_summary |> \n  filter(tract_name == c(\"138\", \"139\"))\n\nsharswood_2017_tract <- sharswood_2017_tract_sf |> \n  st_drop_geometry()\nsharswood_2017_tract\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n        GEOID tract_name  county_name total_popE median_incomeE elderly_popE\n1 42101013900        139 Philadelphia       2603          15028          449\n2 42101013800        138 Philadelphia       1840          27065          211\n  elderly_popM pct_elderly child_popE child_popM pct_child pct_poverty\n1    113.36225       17.25        435   179.5661     16.71       41.74\n2     61.48984       11.47        361   107.6336     19.62       33.09\n  pct_white pct_black pct_hispanic\n1     20.36     68.42         8.34\n2     14.67     74.78         5.38\n```\n\n\n:::\n:::\n\n\n### Step 4: Repeat Process for 2008-2012 ACS 5-Yr Estimates\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Get tract-level demographic data from 2022 ACS 5-Yr Estimates for Philadelphia\nphl_2012_tract_data <- get_acs(\n  geography = \"tract\",\n  variables = vars,\n  state = \"PA\",\n  county = \"Philadelphia\",\n  year = 2012,\n  survey = \"acs5\",\n  output = \"wide\",\n  geometry = TRUE\n)\n\n# Clean the county names to remove state name and \"County\" \nphl_2012_tract_clean <- phl_2012_tract_data |> \n  separate(\n    NAME, \n    into = c(\"tract_name\", \"county_name\", \"state_name\"), \n    sep = \", \"\n  ) |> \n  mutate(\n    tract_name = str_remove(tract_name, \"Census Tract \"),\n    county_name = str_remove(county_name, \" County\")\n  )\nphl_2012_tract_summary <- summarize_acs(phl_2012_tract_clean)\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Filter Census Tracts for Sharswood\nsharswood_2012_tract_sf <- phl_2012_tract_summary |> \n  filter(tract_name %in% c(\"138\", \"139\"))\n\nsharswood_2012_tract <- sharswood_2012_tract_sf |> \n  st_drop_geometry()\nsharswood_2012_tract\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n        GEOID tract_name  county_name total_popE median_incomeE elderly_popE\n1 42101013800        138 Philadelphia       2026          26500          243\n2 42101013900        139 Philadelphia       3323          15542          419\n  elderly_popM pct_elderly child_popE child_popM pct_child pct_poverty\n1     98.40732       11.99        482   206.3032     23.79       23.59\n2    147.05441       12.61        828   213.2815     24.92       59.07\n  pct_white pct_black pct_hispanic\n1      8.49     82.63         3.11\n2      8.28     85.43         3.37\n```\n\n\n:::\n:::\n\n\n--------------------------------------------------------------------------------\n\n## Part 2: Comprehensive Visualization and Analysis\n\n--------------------------------------------------------------------------------\n\n### Step 1: Rename Columns for ACS Year\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncols_to_suffix <- c(\n  \"total_popE\",\"median_incomeE\",\n  \"elderly_popE\",\"elderly_popM\",\"pct_elderly\",\n  \"child_popE\",\"child_popM\",\"pct_child\", \"pct_poverty\",\n  \"pct_white\", \"pct_black\", \"pct_hispanic\"\n)\n\ns12_sf <- sharswood_2012_tract_sf |>\n  rename_with(~ paste0(.x, \"_2012\"), any_of(cols_to_suffix))\ns12 <- sharswood_2012_tract |>\n  rename_with(~ paste0(.x, \"_2012\"), any_of(cols_to_suffix))\ns17_sf <- sharswood_2017_tract_sf |>\n  rename_with(~ paste0(.x, \"_2017\"), any_of(cols_to_suffix))\ns17 <- sharswood_2017_tract |>\n  rename_with(~ paste0(.x, \"_2017\"), any_of(cols_to_suffix))\ns22_sf <- sharswood_2022_tract_sf |>\n  rename_with(~ paste0(.x, \"_2022\"), any_of(cols_to_suffix))\ns22 <- sharswood_2022_tract |>\n  rename_with(~ paste0(.x, \"_2022\"), any_of(cols_to_suffix))\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncompare_sf <- s12_sf |>\n  select(GEOID, tract_name, county_name, geometry, ends_with(\"_2012\")) |>\n  left_join(select(s17, GEOID, ends_with(\"_2017\")), by = \"GEOID\") |>\n  left_join(select(s22, GEOID, ends_with(\"_2022\")), by = \"GEOID\") |>\n  mutate(\n    pop_change_12_22       = total_popE_2022 - total_popE_2012,\n    pop_pct_change_12_22   = 100 * (total_popE_2022 - total_popE_2012) / total_popE_2012,\n\n    d_pct_child_12_22    = pct_child_2022    - pct_child_2012,\n    d_pct_elderly_12_22  = pct_elderly_2022  - pct_elderly_2012,\n    d_pct_poverty_12_22  = pct_poverty_2022  - pct_poverty_2012,\n    d_pct_white_12_22    = pct_white_2022    - pct_white_2012,\n    d_pct_black_12_22    = pct_black_2022    - pct_black_2012,\n    d_pct_hispanic_12_22 = pct_hispanic_2022 - pct_hispanic_2012,\n\n    d_income_12_17 = median_incomeE_2017 - median_incomeE_2012,\n    d_income_17_22 = median_incomeE_2022 - median_incomeE_2017,\n    d_income_12_22 = median_incomeE_2022 - median_incomeE_2012\n  )\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Table 1: Population\ntbl_pop <- compare_sf |>\n  st_drop_geometry() |>\n  select(\n    GEOID, total_popE_2012, total_popE_2017, total_popE_2022,\n    pop_change_12_22, pop_pct_change_12_22,\n    pct_child_2012, pct_child_2017, pct_child_2022, d_pct_child_12_22,\n    pct_elderly_2012, pct_elderly_2017, pct_elderly_2022, d_pct_elderly_12_22\n  ) |>\n  rename(\n    `Census Tract` = GEOID,\n    `Total Pop (2012)` = total_popE_2012,\n    `Total Pop (2017)` = total_popE_2017,\n    `Total Pop (2022)` = total_popE_2022,\n    `Δ pop 12–22`      = pop_change_12_22,\n    `% change 12–22`   = pop_pct_change_12_22,\n    `Child % 2012`     = pct_child_2012,\n    `Child % 2017`     = pct_child_2017,\n    `Child % 2022`     = pct_child_2022,\n    `Δ Child (pp) 12–22` = d_pct_child_12_22,\n    `Elderly % 2012`     = pct_elderly_2012,\n    `Elderly % 2017`     = pct_elderly_2017,\n    `Elderly % 2022`     = pct_elderly_2022,\n    `Δ Elderly (pp) 12–22` = d_pct_elderly_12_22\n  )\n\nkable(tbl_pop, digits = 1, caption = \"Sharswood: Changes in Population\",\n      format.args = list(big.mark = \",\"))\n```\n\n::: {.cell-output-display}\n\n\nTable: Sharswood: Changes in Population\n\n|Census Tract | Total Pop (2012)| Total Pop (2017)| Total Pop (2022)| Δ pop 12–22| % change 12–22| Child % 2012| Child % 2017| Child % 2022| Δ Child (pp) 12–22| Elderly % 2012| Elderly % 2017| Elderly % 2022| Δ Elderly (pp) 12–22|\n|:------------|----------------:|----------------:|----------------:|-----------:|--------------:|------------:|------------:|------------:|------------------:|--------------:|--------------:|--------------:|--------------------:|\n|42101013800  |            2,026|            1,840|            2,077|          51|            2.5|         23.8|         19.6|         12.3|              -11.5|           12.0|           11.5|            6.1|                 -5.9|\n|42101013900  |            3,323|            2,603|            2,585|        -738|          -22.2|         24.9|         16.7|         16.3|               -8.6|           12.6|           17.2|           15.1|                  2.5|\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Table 2: Race\ntbl_race <- compare_sf |>\n  st_drop_geometry() |>\n  select(\n    GEOID, pct_white_2012, pct_white_2017, pct_white_2022, d_pct_white_12_22,\n    pct_black_2012, pct_black_2017, pct_black_2022, d_pct_black_12_22,\n    pct_hispanic_2012, pct_hispanic_2017, pct_hispanic_2022, d_pct_hispanic_12_22\n  ) |>\n  rename(\n    `Census Tract` = GEOID,\n    `White % 2012` = pct_white_2012,\n    `White % 2017` = pct_white_2017,\n    `White % 2022` = pct_white_2022,\n    `Δ White (pp) 12–22` = d_pct_white_12_22,\n    `Black % 2012` = pct_black_2012,\n    `Black % 2017` = pct_black_2017,\n    `Black % 2022` = pct_black_2022,\n    `Δ Black (pp) 12–22` = d_pct_black_12_22,\n    `Hispanic % 2012` = pct_hispanic_2012,\n    `Hispanic % 2017` = pct_hispanic_2017,\n    `Hispanic % 2022` = pct_hispanic_2022,\n    `Δ Hispanic (pp) 12–22` = d_pct_hispanic_12_22\n  )\n\nkable(tbl_race, digits = 1, caption = \"Sharswood: Changes in Race\")\n```\n\n::: {.cell-output-display}\n\n\nTable: Sharswood: Changes in Race\n\n|Census Tract | White % 2012| White % 2017| White % 2022| Δ White (pp) 12–22| Black % 2012| Black % 2017| Black % 2022| Δ Black (pp) 12–22| Hispanic % 2012| Hispanic % 2017| Hispanic % 2022| Δ Hispanic (pp) 12–22|\n|:------------|------------:|------------:|------------:|------------------:|------------:|------------:|------------:|------------------:|---------------:|---------------:|---------------:|---------------------:|\n|42101013800  |          8.5|         14.7|         25.3|               16.8|         82.6|         74.8|         59.5|              -23.2|             3.1|             5.4|             5.8|                   2.7|\n|42101013900  |          8.3|         20.4|         26.0|               17.7|         85.4|         68.4|         51.6|              -33.8|             3.4|             8.3|            21.1|                  17.7|\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Table 3: Income\ntbl_income <- compare_sf |>\n  st_drop_geometry() |>\n  select(\n    GEOID, \n    pct_poverty_2012, pct_poverty_2017, pct_poverty_2022, d_pct_poverty_12_22,\n    median_incomeE_2012, median_incomeE_2017, median_incomeE_2022,\n    d_income_12_17, d_income_17_22, d_income_12_22\n  ) |>\n  rename(\n    `Census Tract` = GEOID,\n    `Poverty % 2012`      = pct_poverty_2012,\n    `Poverty % 2017`      = pct_poverty_2017,\n    `Poverty % 2022`      = pct_poverty_2022,\n    `Δ Poverty (pp) 12–22`= d_pct_poverty_12_22,\n    `Median income (2012)`= median_incomeE_2012,\n    `Median income (2017)`= median_incomeE_2017,\n    `Median income (2022)`= median_incomeE_2022,\n    `Δ income 12–17`      = d_income_12_17,\n    `Δ income 17–22`      = d_income_17_22,\n    `Δ income 12–22`      = d_income_12_22\n  )\n\nkable(tbl_income, digits = 1, caption = \"Sharswood: Changes in Income & Poverty\",\n      format.args = list(big.mark = \",\"))\n```\n\n::: {.cell-output-display}\n\n\nTable: Sharswood: Changes in Income & Poverty\n\n|Census Tract | Poverty % 2012| Poverty % 2017| Poverty % 2022| Δ Poverty (pp) 12–22| Median income (2012)| Median income (2017)| Median income (2022)| Δ income 12–17| Δ income 17–22| Δ income 12–22|\n|:------------|--------------:|--------------:|--------------:|--------------------:|--------------------:|--------------------:|--------------------:|--------------:|--------------:|--------------:|\n|42101013800  |           23.6|           33.1|            9.2|                -14.3|               26,500|               27,065|               68,864|            565|         41,799|         42,364|\n|42101013900  |           59.1|           41.7|           32.8|                -26.3|               15,542|               15,028|               41,042|           -514|         26,014|         25,500|\n\n\n:::\n:::\n\n\n### Step 2: Facet Maps by Period\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Convert from Wide to Long\nlong_panel <- compare_sf |>\n  pivot_longer(\n    cols = matches(\"_(2012|2017|2022)$\"),\n    names_to = c(\"metric\",\"period\"),\n    names_pattern = \"(.+)_([0-9]{4})$\",\n    values_to = \"value\"\n  ) \n\nlong_panel_pts <- long_panel |> st_point_on_surface()\n\n# Facet Helper with Boxed Labels\nfacet_metric <- function(metric_name, title, fill_lab,\n                         fill_lab_fmt = NULL, text_fmt = NULL,\n                         text_size = 3, box_fill = alpha(\"white\", 0.60)) {\n\n  dat <- long_panel     |> filter(metric == metric_name)\n  lab <- long_panel_pts |> filter(metric == metric_name)\n\n  if (is.null(text_fmt)) text_fmt <- label_number(accuracy = 1)\n  lab <- lab |> mutate(lbl = text_fmt(value))\n\n  ggplot() +\n    geom_sf(data  = dat, aes(fill = value), color = \"grey25\", linewidth = 0.25) +\n    geom_sf_label(data  = lab, aes(label = lbl), size = text_size, \n                  label.size = 0, label.padding = unit(1.2, \"pt\"),    \n                  fill = box_fill, color   = \"black\", label.r = unit(1.5, \"pt\"),\n                  check_overlap = TRUE, na.rm   = TRUE, show.legend = FALSE) +\n    facet_wrap(~ period, nrow = 1) +\n    labs(\n      title = title, \n      subtitle = \"Panels: 2012, 2017, 2022\",\n      fill = fill_lab,\n      caption = \"ACS 5-year estimates\"\n    ) +\n    theme_void() +\n    theme(legend.position = \"right\") +\n    {\n      if (is.null(fill_lab_fmt)) {\n        scale_fill_viridis_c()\n      } else {\n        scale_fill_viridis_c(labels = fill_lab_fmt)\n      }\n    }\n}\n\n# Format Data Labels\npct_fmt <- label_number(accuracy = 0.1, suffix = \"%\")  # your % values are 0–100\ndol_fmt <- label_dollar(accuracy = 1)\n\n# Facet Maps\nfacet_metric(\"pct_poverty\",    \"Sharswood: % in Poverty\", \"%\", \n             fill_lab_fmt = pct_fmt, text_fmt = pct_fmt)\n```\n\n::: {.cell-output-display}\n![](demographic_change_files/figure-html/unnamed-chunk-16-1.png){width=672}\n:::\n\n```{.r .cell-code}\nfacet_metric(\"pct_white\",      \"Sharswood: % White (race alone)\", \"%\", \n             fill_lab_fmt = pct_fmt, text_fmt = pct_fmt)\n```\n\n::: {.cell-output-display}\n![](demographic_change_files/figure-html/unnamed-chunk-16-2.png){width=672}\n:::\n\n```{.r .cell-code}\nfacet_metric(\"pct_black\",      \"Sharswood: % Black (race alone)\", \"%\", \n             fill_lab_fmt = pct_fmt, text_fmt = pct_fmt)\n```\n\n::: {.cell-output-display}\n![](demographic_change_files/figure-html/unnamed-chunk-16-3.png){width=672}\n:::\n\n```{.r .cell-code}\nfacet_metric(\"pct_hispanic\",   \"Sharswood: % Hispanic (any race)\", \"%\", \n             fill_lab_fmt = pct_fmt, text_fmt = pct_fmt)\n```\n\n::: {.cell-output-display}\n![](demographic_change_files/figure-html/unnamed-chunk-16-4.png){width=672}\n:::\n\n```{.r .cell-code}\nfacet_metric(\"pct_child\",      \"Sharswood: % Children (5–19)\", \"%\", \n             fill_lab_fmt = pct_fmt, text_fmt = pct_fmt)\n```\n\n::: {.cell-output-display}\n![](demographic_change_files/figure-html/unnamed-chunk-16-5.png){width=672}\n:::\n\n```{.r .cell-code}\nfacet_metric(\"pct_elderly\",    \"Sharswood: % Elderly (65+)\", \"%\", \n             fill_lab_fmt = pct_fmt, text_fmt = pct_fmt)\n```\n\n::: {.cell-output-display}\n![](demographic_change_files/figure-html/unnamed-chunk-16-6.png){width=672}\n:::\n\n```{.r .cell-code}\nfacet_metric(\"median_incomeE\", \"Sharswood: Median Household Income\", \"$\", \n             fill_lab_fmt = dol_fmt, text_fmt = dol_fmt)\n```\n\n::: {.cell-output-display}\n![](demographic_change_files/figure-html/unnamed-chunk-16-7.png){width=672}\n:::\n:::\n\n\n### Step 3: Change Maps\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# helper to make a diverging change map\nchange_map <- function(col, title, legend) {\n  ggplot(compare_sf) +\n    geom_sf(aes(fill = .data[[col]]), color = \"grey25\", linewidth = 0.25) +\n    scale_fill_gradient2(midpoint = 0, name = legend) +\n    labs(title = title) +\n    theme_void()\n}\n\nchange_map(\"d_pct_poverty_12_22\",  \"Change in % Poverty (2012→2022)\",  \"Δ pct-pts\")\n```\n\n::: {.cell-output-display}\n![](demographic_change_files/figure-html/unnamed-chunk-17-1.png){width=432}\n:::\n\n```{.r .cell-code}\nchange_map(\"d_pct_child_12_22\",    \"Change in % Children (2012→2022)\", \"Δ pct-pts\")\n```\n\n::: {.cell-output-display}\n![](demographic_change_files/figure-html/unnamed-chunk-17-2.png){width=432}\n:::\n\n```{.r .cell-code}\nchange_map(\"d_pct_elderly_12_22\",  \"Change in % Elderly (2012→2022)\",  \"Δ pct-pts\")\n```\n\n::: {.cell-output-display}\n![](demographic_change_files/figure-html/unnamed-chunk-17-3.png){width=432}\n:::\n\n```{.r .cell-code}\nchange_map(\"d_pct_white_12_22\",    \"Change in % White (2012→2022)\",    \"Δ pct-pts\")\n```\n\n::: {.cell-output-display}\n![](demographic_change_files/figure-html/unnamed-chunk-17-4.png){width=432}\n:::\n\n```{.r .cell-code}\nchange_map(\"d_pct_black_12_22\",    \"Change in % Black (2012→2022)\",    \"Δ pct-pts\")\n```\n\n::: {.cell-output-display}\n![](demographic_change_files/figure-html/unnamed-chunk-17-5.png){width=432}\n:::\n\n```{.r .cell-code}\nchange_map(\"d_pct_hispanic_12_22\", \"Change in % Hispanic (2012→2022)\", \"Δ pct-pts\")\n```\n\n::: {.cell-output-display}\n![](demographic_change_files/figure-html/unnamed-chunk-17-6.png){width=432}\n:::\n\n```{.r .cell-code}\nchange_map(\"pop_pct_change_12_22\", \"Population % Change (2012→2022)\",  \"% change\")\n```\n\n::: {.cell-output-display}\n![](demographic_change_files/figure-html/unnamed-chunk-17-7.png){width=432}\n:::\n\n```{.r .cell-code}\nchange_map(\"d_income_12_22\",       \"Change in Median Income (2012→2022) — period $\", \"$ change\")\n```\n\n::: {.cell-output-display}\n![](demographic_change_files/figure-html/unnamed-chunk-17-8.png){width=432}\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Demographic Change\nbars <- long_panel |>\n  filter(metric %in% c(\"pct_child\",\"pct_elderly\")) |>\n  mutate(metric = recode(metric, pct_child = \"% Children (5–19)\", pct_elderly = \"% Elderly (65+)\"))\n\nggplot(bars, aes(x = period, y = value, fill = period)) +\n  geom_col(width = 0.7) +\n  facet_grid(metric ~ tract_name, scales = \"free_y\") +\n  scale_y_continuous(labels = label_number(accuracy = 0.1)) +\n  labs(title = \"Before–After Comparison by Tract and Period\",\n       x = NULL, y = \"Percent\") +\n  theme_minimal() + theme(legend.position = \"none\")\n```\n\n::: {.cell-output-display}\n![](demographic_change_files/figure-html/unnamed-chunk-18-1.png){width=672}\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Income and Poverty Change\nperiod_lab <- c(\"2012\" = \"2008–12\", \"2017\" = \"2013–17\", \"2022\" = \"2018–22\")\nperiod_pal <- c(\"2008–12\" = \"#8DA0CB\", \"2013–17\" = \"#66C2A5\", \"2018–22\" = \"#FC8D62\")\n\n# Plot Median Income\nbars_income <- long_panel |>\n  filter(metric == \"median_incomeE\") |>\n  mutate(period = recode(period, !!!period_lab))\n\nggplot(bars_income, aes(x = period, y = value, fill = period)) +\n  geom_col(width = 0.7) +\n  facet_grid(~ tract_name, scales = \"free_y\") +\n  scale_fill_manual(values = period_pal, guide = \"none\") +\n  scale_y_continuous(labels = label_dollar(accuracy = 1)) +\n  labs(\n    title = \"Before–After: Median Household Income by Tract\",\n    x = NULL, y = \"Dollars\"\n  ) +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](demographic_change_files/figure-html/unnamed-chunk-19-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# Plot Poverty Rate\nbars_poverty <- long_panel |>\n  filter(metric == \"pct_poverty\") |>\n  mutate(period = recode(period, !!!period_lab))\n\nggplot(bars_poverty, aes(x = period, y = value, fill = period)) +\n  geom_col(width = 0.7) +\n  facet_grid(~ tract_name, scales = \"free_y\") +\n  scale_fill_manual(values = period_pal, guide = \"none\") +\n  scale_y_continuous(labels = label_number(accuracy = 0.1, suffix = \"%\")) +\n  labs(\n    title = \"Before–After: Poverty Rate by Tract\",\n    x = NULL, y = \"Percent\"\n  ) +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](demographic_change_files/figure-html/unnamed-chunk-19-2.png){width=672}\n:::\n:::\n\n\n### Step 4: Composite Maps\n\n**Multi-metric × Period Grid**\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngrid_metrics <- c(\"pct_poverty\",\"pct_child\",\"pct_elderly\",\"pct_black\",\"pct_white\",\"pct_hispanic\")\n\nmetric_labels <- c(\"Poverty %\",\"Children %\",\"Elderly %\",\n                   \"Black %\",\"White %\",\"Hispanic %\")\n\nlong_subset <- long_panel |>\n  filter(metric %in% grid_metrics) |>\n  mutate(\n    metric = factor(metric, levels = grid_metrics, labels = metric_labels),\n    period = factor(period, \n                    levels = c(\"2012\",\"2017\",\"2022\"),\n                    labels  = c(\"2008–12\",\"2013–17\",\"2018–22\"))\n  )\n\nlong_subset_pts <- long_panel_pts |>\n  filter(metric %in% grid_metrics) |>\n  mutate(\n    metric = factor(metric, levels = grid_metrics, labels = metric_labels),\n    period = factor(period, \n                    levels = c(\"2012\",\"2017\",\"2022\"),\n                    labels  = c(\"2008–12\",\"2013–17\",\"2018–22\")),\n    lbl = label_number(accuracy = 0.1, suffix = \"%\")(value)  \n  )\n\nggplot() +\n  geom_sf(data = long_subset, aes(fill = value), \n          color = \"grey25\", linewidth = 0.25) +\n  geom_sf_label(data = long_subset_pts, aes(label = lbl), \n                size = 3, label.size = 0,\n                label.padding = unit(1, \"pt\"), fill = alpha(\"white\", 0.60),\n                color = \"black\", show.legend = FALSE) +\n  facet_grid(metric ~ period) +\n  scale_fill_distiller(palette = \"Spectral\", breaks = c(0, 25, 50, 75, 100),\n                       limits = c(0, 100), direction = 1, \n                       labels = label_number(accuracy = 1, suffix = \"%\")) +\n\n  guides(fill = guide_colorbar(title.position = \"top\", ticks = TRUE, \n                               barheight = unit(80, \"pt\"),\n                               bardwidth = unit(5, \"pt\"))) +\n  labs(title = \"Sharswood: ACS 5-Yr Estimates by Census Tract\") +\n  theme_void() + \n  theme(legend.position = \"right\",\n        plot.title = element_text(face = \"bold\", size = 12))\n```\n\n::: {.cell-output-display}\n![](demographic_change_files/figure-html/unnamed-chunk-20-1.png){width=672}\n:::\n:::\n\n\n**Bivariate change map**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(forcats)\n\nbivar <- compare_sf %>%\n  st_drop_geometry() %>%\n  transmute(GEOID,\n            d_pov = d_pct_poverty_12_22,\n            d_inc = d_income_12_22) %>%\n  mutate(\n    c_pov = cut_number(d_pov, n = 3, labels = c(\"low Δpov\",\"mid Δpov\",\"high Δpov\")),\n    c_inc = cut_number(d_inc, n = 3, labels = c(\"low Δinc\",\"mid Δinc\",\"high Δinc\")),\n    bivar_class = interaction(fct_rev(c_pov), c_inc, sep = \" / \", drop = TRUE)\n  )\n\n# simple 3x3 palette\npal <- c(\n  \"high Δpov / low Δinc\"  = \"#3F2949\",\"high Δpov / mid Δinc\" = \"#435786\",\"high Δpov / high Δinc\" = \"#4885C1\",\n  \"mid Δpov / low Δinc\"   = \"#77324C\",\"mid Δpov / mid Δinc\"  = \"#806A8A\",\"mid Δpov / high Δinc\"  = \"#89A1C8\",\n  \"low Δpov / low Δinc\"   = \"#AE3A4E\",\"low Δpov / mid Δinc\"  = \"#BC7C8F\",\"low Δpov / high Δinc\"  = \"#CABED0\"\n)\n\ncompare_bivar <- compare_sf %>% left_join(bivar, by = \"GEOID\")\n\nggplot(compare_bivar) +\n  geom_sf(aes(fill = bivar_class), color = \"grey25\", linewidth = 0.25) +\n  scale_fill_manual(values = pal, na.value = \"grey85\", name = \"Δ Poverty vs Δ Income\\n(2012→2022)\") +\n  labs(title = \"Bivariate Change Map: Poverty (pct-pts) vs Income ($)\") +\n  theme_void()\n```\n\n::: {.cell-output-display}\n![](demographic_change_files/figure-html/unnamed-chunk-21-1.png){width=672}\n:::\n:::\n\n",
    "supporting": [
      "demographic_change_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}