{
  "hash": "954b9cb2b7359e99983ba1a06e646570",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Week 7 Notes - Model Diagnostics and Spatial Autocorrelation\"\ndate: \"2025-10-20\"\n---\n\n## Key Concepts Learned\n\n### Regression Workflow\n\n**Building the model:**\n\n1.  Visualize relationships\n2.  Engineer features\n3.  Fir the model\n4.  Evaluate performance (RMSE, R²)\n5.  Check assumptions\n\n**Spatial Diagnostics**\n\n6.  Are errors random or clustered?\n7.  Do we predict better in some areas?\n8.  Is there remaining spatial structure?\n\n**Spatial Autocorrelation in Errors (i.e. Clustered Errors)**\n\n-   spatial pattern visible (not random scatter)\n\n-   under/over-predict in areas\n\n-   model misses something about location\n\n**Moran's I measures Spatial Autocorrelation**\n\n*Intuition: When I’m above/below average, are my neighbors also above/below average?*\n\n**Range:** -1 to +1\n\n-   **+1** = Perfect positive correlation (clustering)\n\n-   **0** = Random spatial pattern\n\n-   **-1** = Perfect negative correlation (dispersion)\n\n------------------------------------------------------------------------\n\n**Defining Neighbors:**\n\n![](images/clipboard-88185342.png){width=\"987\"}\n\n**Sample Example:**\n\n![](images/clipboard-2995180422.png){width=\"451\"}\n\n**Step 1: Calculate Deviations from Mean**\n\n![](images/clipboard-2249328638.png){width=\"471\"}\n\n**Positive deviation** = we over-predicted (actual \\> predicted)\\\n**Negative deviation** = we under-predicted (actual \\< predicted)\n\n**Step 2: Multiply Neighbor Pair Deviations**\n\n![](images/clipboard-645011366.png)\n\n-   Lots of positive products → **High Moran’s I** (clustering)\n\n-   Products near zero → **Low Moran’s I** (random)\n\n-   Negative products → **Negative Moran’s I** (rare with errors)\n\n**Step 3: Possible Solutions**\n\nIf Moran’s I shows clustered errors:\n\n✅ **Add more spatial features** (different buffers, more amenities)\\\n✅ **Try neighborhood fixed effects**\\\n✅ **Use spatial cross-validation**\n\n------------------------------------------------------------------------\n\n**Issues with Spatial Lag for Prediction:**\n\n1.  **Simultaneity Problem (circular logic)**\n\n-   My price affects neighbors → neighbors affect me\n\n-   OLS estimates are biased and inconsistent\n\n2.  **Prediction Paradox (poor generalizability)**\n\n-   Need neighbors’ prices to predict my price\n\n-   But for new developments or future periods, those prices don’t exist yet\n\n3.  **Data Leakage in CV**\n\n-   Spatial Lag \"leaks\" information from test set\n\n-   Artificially good performance that won't hold\n\n![](images/clipboard-4100208631.png){width=\"251\"}\n\n**Key Idea: Match method to purpose:** \n\n-   **inference** → spatial lag/error models; **prediction** → spatial features\n\n-   **our predicton approach:** Instead of modeling dependence in Y (prices), model proximity in X (predictors)\n\n## Coding Techniques\n\n-   **Create and Plot the Spatial Lag**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(spdep)\n\n# Define neighbors (5 nearest)\ncoords <- st_coordinates(boston_test)\nneighbors <- knn2nb(knearneigh(coords, k=5))\nweights <- nb2listw(neighbors, style=\"W\")\n\n# Calculate spatial lag of errors\nboston_test$error_lag <- lag.listw(weights, boston_test$error)\n```\n:::\n\n\n-   **Calculate Moran's I**\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Test for spatial autocorrelation in errors\nmoran_test <- moran.mc(\n  boston_test$error,        # Your errors\n  weights,                  # Spatial weights matrix\n  nsim = 999                # Number of permutations\n)\n\n# View results\nmoran_test$statistic         # Moran's I value\n```\n:::\n\n\n## Questions & Challenges\n\n-   The intuition behind Moran's I is \"*When I’m above/below average, are my neighbors also above/below average?\"* I'm curious if incorporating models such as kNN can help to meaningfully reduce spatial lag?\n\n## Connections to Policy\n\n-   Research methods should follow policy intents and purposes. When looking at market forecasting or policy predictions, the predictive spatial features described above are more useful than spatial econometrics models\n\n## Reflection\n\n-   I had never heard of Spatial Lag, Spatial Autocorrelation, or Moran's I before this class as I have not taken spatial statistics, so this was a very useful crash course!\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}